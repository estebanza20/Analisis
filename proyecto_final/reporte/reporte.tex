%Archivo de muestra de un Informe de práctica o laboratorio
% utilizando la clase eieinforme.cls (V.M. Alfaro)
%---------------------------------------------------------------------

%preámbulo - uso de la clase eieinforme
\documentclass{eieinforme}
%
%--------- <Agregue aquí algún paquete extra que sea necesario---------
\usepackage{booktabs}
\usepackage{url}
\usepackage{empheq}
\usepackage{hyperref}
\usepackage[spanish]{babel}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=black,      
    urlcolor=black,
}

%--------- Agregue aquí algún paquete extra que sea necesario>---------
%
\begin{document}
\pagenumbering{roman}

%------------ Desde aquí datos de la portada ------------------%

%título de la práctica (* Por el usuario *)
\title{Proyecto final:\\ Modelado del comportamiento de los robots de dos ruedas}

%nombre del curso (* Por el usuario *)
\curso{IE-0409 Análisis de Sistemas}

%nombre completo de los autores (* Por el usuario *)
\autorA{Ariel Fallas Pizarro, B42481}
\autorB{Daniel García Vaglio, B42781}
\autorC{Esteban Zamora Alvarado, B47769}

%fecha de presentación (* si se deja en blanco indicará la fecha de la compilación)
%\date{Mes de año}

%---------------hasta aquí datos de la portada-------------------------
%
%--------------------------------------------------------------------------------
%portada
\eietitlepage
\newpage
%--------------------------------------------------------------------------------
%
%---------------------------------------------------------------------------------
%------------- A partir de aquí se escribe el informe ----------------------------
%---------------------------------------------------------------------------------
%las siguientes son las secciones iniciales del informe

%Esto hay que revisarlo!

\section{Resumen}
Los robots móviles son muy importantes porque permiten sistemas más flexibles, abriendo toda un área
de la robótica que involucra el problema de la localización%referencias.
En el presente documento se analiza el caso específico de un robot diferencial, el cual es un sistema que
se moviliza en el plano xy debido a la acción de dos ruedas que funcionan de manera
independiente. Se lleva a cabo la obtención de un modelo cinemático directo, un modelo cinemático
inverso, y un modelo dinámico que describe las consideraciones energéticas del sistema. Se
realizaron las simulaciones correspondientes para cada modelo, para luego analizar la respuesta
 del movimiento del sistema a las entradas respectivas. 


%-------------------
%tablas de contenido (* si alguna no se ocupa se puede ``comentar'' (%) para que no aparezca)
\newpage
\tableofcontents
\newpage
\listoffigures
\newpage
\listoftables
\newpage

%-------------------------------------------------------------------
%lista de la nomenclatura utilizada en el texto

\section*{Nomenclatura}

\begin{description}[labelindent=1cm,labelwidth=2.25cm,align=left]
%ponerlo en orden alfabetico
        \item[$L$] Lagrangiano de un sistema
        \item[$T$] Energía cinética de un sistema
        \item[$V$] Energía potencial de un sistema
        \item[$q_j$] Coordenada generalizada
        \item[$Q_j$] Fuerza generalizada
        \item[$n$] Cantidad de grados de libertad de un sistema
        \item[$J$] Momento de inercia de un cuerpo
        \item[$m$] Masa de un cuerpo
        \item[$\vec{v}$] Velocidad del centro de masa de un cuerpo
        \item[$\omega$] Velocidad angular
        \item[$k$] Constante de un resorte traslacional
        \item[$d$] Elongación de un resorte traslacional
        \item[$h$] Altura del centro de masa de un cuerpo con respecto a la referencia
        \item[$g$] Constante de la gravedad terrestre
        \item[$p_0$] Posición del centro geométrico
        \item[$p_d$] Posición del punto desplazado
        \item[$p_g$] Posición del centro de masa
        \item[$2b$]  Ancho del robot
        \item[$p_r$] Posición de la rueda derecha
        \item[$p_l$] Posición de la rueda izquierda 
        \item[$\varphi_r$] Posición angular de la rueda derecha
        \item[$\varphi_l$] Posición angular de la rueda izquierda
        \item[$K$]  Energía cinética
        \item[$r$] Radio de una rueda
        \item[$m_c$] Masa del cuerpo del robot
        \item[$m_w$] Masa de una rueda
        \item[$I_g$] Momento de inercia del cuerpo alrededor del centro de masa
        \item[$I_w$] Momento de inercia de una rueda alrededor de su eje central
        \item[$I_m$] Momento de inercia de una rueda alrededor de un diámetro
        \item[$\omega$] Rapidez angular de la rotación del robot
        \item[$\theta$] Orientación del robot
        \item[$x$] Posición del centro geométrico en el eje X
        \item[$y$] Posición del centro geométrico en el eje Y
       
\end{description}

%--------------------
\newpage
\pagenumbering{arabic}
\pagestyle{fancy}
\setlength\headheight{14.5pt}
\lhead{\nouppercase{\leftmark}}
\rhead{\thepage}
\fancyfoot{}

% ------------------------------------------------------------------ Secciones del informe (puede
% ser un solo archivo o separarse los secciones en archivos independientes e incluirse
% con \include('nombre_archivo') si se quiere una nueva página antes de la parte que se está
% anexando o \input{'nombre de archivo'} si se quiere agregar directamente en la posición donde se
% llama a \input{}


%------------------
\section{Introducción}
El desarrollo de robots móviles, responde a la necesidad de extender el campo de aplicación de la
Robótica en la actualidad. En este campo, se trata de incrementar la autonomía del robot, limitando
en todo lo posible la necesidad de intervención humana \citep{Collazo}.

Los robots de dos ruedas, tienen la ventaja de que son altamente maniobrables, al poder girar sobre
su eje z como lo muestra la figura \ref{ejes}. También, pueden construirse altos sin requerir de una base muy grande, lo que los
hace muy útiles en interiores, en donde pueden pasar por lugares estrechos y dar curvas muy cerradas
\citep{KarlStol}.  Algunas de sus aplicaciones, pueden ser como guías de excursiones dentro de
museos, bases de equipo médico dentro de hospitales, para vigilancia (segway) y de limpieza en el
hogar \citep{Coelho}.

\subsection{Objetivos}

Se establecieron los siguientes objetivos para el desarrollo del trabajo:

\begin{itemize}
	\item Estudiar la dinámica de un robot de dos ruedas.
	
	\item Analizar el sistema y obtener un modelo matemático que lo describa
	
	\item Simular el sistema.

\end{itemize}


\section{Marco teórico}

%\subsection{Descripción general de los robots de dos ruedas}


%El sistema que se estudia son los robots de dos ruedas coaxiales, encontrándose normalmente una a
%cada lado del cuerpo, con el centro de masa sobre el eje de las ruedas. Debido a que el centro de
%masa se encuentra sobre el eje de las ruedas, estos robots también son conocidos como péndulos
%invertidos móviles \citep{Yan-Hou}, ya que su base no está fija en el espacio, sino que puede
%desplazarse sobre una superficie debido a la acción de las ruedas (ver figura
%\ref{fig:segway_robot}).

%Estos robots tienen 3 grados de libertad, los cuales son: traslación hacia adelante o atrás, giro
%sobre su propio eje (yaw), y giro sobre el eje de las ruedas (pitch) (ver figura
%\ref{fig:axis}). Sin embargo, el robot únicamente tiene dos actuadores (las dos ruedas). Por lo
%tanto, se considera un sistema subactuado \citep{Xu}. De esta manera, no se puede lograr el control
%del movimiento del robot en los tres grados de libertad de forma independiente, ya que si se
%controla uno de ellos, los otros también se ven afectados. 


%\begin{figure}
%	\centering
%	\includegraphics[width=0.6\textwidth]{../pictures/robot-segway.png}	
%	\caption{Ejemplo de robot de dos ruedas}
%	\label{fig:segway_robot}
%\end{figure}

%Se debe notar que para que el sistema sea estable, se necesitan al menos tres puntos de apoyo
%\citep{KarlStol}. La mayor propiedad de este sistema, es que se considera dinámicamente estable
%\citep{Yan-Hou} o estáticamente inestable \citep{KarlStol}, esto porque se debe tener un controlador
%activo para mantener al sistema cerca de un punto de operación, y así evitar que se caiga.

%Figura 2 de modelling and control of two wheeled robots

%\begin{figure}
%	\centering
%	\includegraphics[width=0.4\textwidth]{../pictures/Axis.pdf}	
%	\caption{Grados de libertad de un robot de dos ruedas}
%	\label{fig:axis}
%\end{figure}

%\subsection{Consideraciones Iniciales}
%El objetivo de estos sistemas es evitar que se caigan, entonces es conveniente tomar la salida como
%el ángulo respecto a la normal con el suelo, es decir el ángulo pitch, denotado como $\phi$. Por
%otra parte, la entrada son los torques que actúan sobre el cuerpo. El torque que provoca la gravedad
%puede no ser considerado como una entrada, pero el torque de las ruedas y el torque de
%perturbaciones externas (como empujar al robot), sí corresponden a entradas.


\subsection{Robots de locomoción diferencial}

Los robots de ruedas diferenciales, son aquellos donde su locomoción está basada en dos (o más) ruedas motrices fijas controladas independientemente, dichas ruedas son las que proporcionan fuerza de tracción al robot. La relación entre ellas es la que determina la trayectoria que va a seguir el robot \citep{Saifizi} . Estos robots son no holónomos por lo tanto son sistemas con restricciones en las velocidades no integrables, es decir no es posible expresarlas, exclusivamente, en término de las posiciones \citep{Freire}.
\\

Algunas de las ventajas de estos sistemas de dos ruedas es que son más baratos, son fáciles de implementar y tienen un diseño simple, por otro lado son un poco más dificiles de controlar ya que son estáticamente inestables y requiere un control de precisión para trayectorias rectas \citep{sis_locomocion} \\.

El modelo de robot que se estudia en el presente trabajo se supone con dos motores independientes, cada uno controlando una rueda, colocados a lo ancho  del eje central del robot. Se asume además su movimiento únicamente en dos dimensiones, por lo que se considera con una tercera rueda que no aporta ningún movimiento adicional (rueda loca o de castor) para que sea estable \citep{KarlStol}, además se considera que no hay deformación en la rueda y que se cumple la condición de rodamiento puro.

%\begin{figure}
%	\centering
%	\includegraphics[width=0.6\textwidth]{../pictures/robot_ejes.eps}	
%	\caption{Ejes del Robot}
%	\label{fig:ejes}
%\end{figure}


\subsection{Método de linealización}
Los sistemas en estudio son intrínsicamente no lineales \citep{Sayidmarie}. De esta manera, para
facilitar el análisis se puede considerar el sistema alrededor de un punto de operación específico,
en donde el mismo puede considerarse como lineal. En el caso específico del sistema a analizar,
si se denomina $\phi$ cómo el ángulo de pitch, ya que el interés es mantener al robot en posición
vertical, se puede tomar como punto de operación la condición de $\phi=0$.

En general, se tiene que el modelo en variables de estado de un sistema no lineal viene dado por la
ecuación \ref{eq:estados_no_lineal}:

\begin{equation}
\frac{d\mathbf{x}(t)}{dt}=f(\mathbf{x}(t),\mathbf{u}(t))
\label{eq:estados_no_lineal}
\end{equation}

Ahora, por el teorema del valor medio, se sabe que existe $t_0<\delta<t$ tal que (ecuación
\ref{eq:mean_theorem}):

\begin{equation}
J_f(\mathbf{x},\mathbf{u})(\mathbf{x}(t_0+\delta)+\mathbf{u}(t_0+\delta))=\frac{f(\mathbf{x}(t),\mathbf{u}(t))-f(\mathbf{x}(t_0),\mathbf{u}(t_0))}{t-t_0}
\label{eq:mean_theorem}
\end{equation}
 
En donde $J_f$ es el jacobiano de $f$. Para el caso particular del punto de operación, se tiene que
$t_0=0$. Como se supone que $t$ es muy cercano a $0$, entonces se aproxima que $\delta=0$. Por otro
lado, $J_{f_x}$ y $J_{f_u}$ son las porciones del jacobiano de $f$ que dependen únicamente de
$\mathbf{x}$ y $\mathbf{u}$, respectivamente.

Se define $\mathbf{x'}(t)=\mathbf{x}(t)-\mathbf{x}(0)$ y
$\mathbf{u'}(t)=\mathbf{u}(t)-\mathbf{u}(0)$. Despejando $f$ de la ecuación \ref{eq:mean_theorem}, y
sustituyendo \ref{eq:estados_no_lineal}, se obtiene la ecuación \ref{eq:meantheo}:

\begin{equation}
\frac{dx'(t)}{dt}=J_{f_x}|_0\mathbf{x'}(t)+J_{f_u}|_0\mathbf{u'}(t)
\label{eq:meantheo}
\end{equation}

De esta manera, se obtiene un modelo en variables de estado lineal cuando el ángulo de pitch es
cercano a cero \citep{Buck}.

\subsection{Análisis de sistemas mecánicos: Enfoque de energías}
Para modelar sistemas mecánicos como el que se estudiará en el presente trabajo, resulta conveniente
utilizar el enfoque de energías, el cual facilita obtener las ecuaciones del movimiento de sistemas
mecánicos con múltiples grados de libertad y que utilicen coordenadas generalizadas (no restringidas
a ser cartesianas).

Las coordenadas generalizadas de un sistema mecánico, se definen como la mínima cantidad de
parámetros que pueden definir de manera completa la configuración del sistema, siendo variables
independientes entre sí \citep{fitzpatrick2011}. Por otro lado, los grados de libertad son la
cantidad de coordenadas que pueden ser modificadas de manera independiente para determinar la
configuración de los cuerpos en el sistema \citep{vandiver2011}.

El Lagrangiano, definido como $L=T-V$, es función de las coordenadas generalizadas y de sus
respectivas derivadas \citep{gavin2014}, tal como se muestra en la ecuación \ref{eq:lagrangian}, en
donde $n$ es la cantidad de grados de libertad del sistema.

\begin{equation}
  L=L(q_{1},...q_{j}...q_{n}, \dot{q_{1}},...\dot{q_{j}}...\dot{q_{n}})
  \label{eq:lagrangian}
\end{equation}

La ecuación \ref{eq:euler-lagrange} se conoce como la ecuación de Euler-Lagrange, y permite obtener
una ecuación de movimiento para cada coordenada generalizada ($q_j$) \citep{vandiver2011}, lo que
genera un sistema de $n$ ecuaciones diferenciales de las cuales se puede construir el modelo en
variables de estado.

\begin{equation}
  \frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q_j}}\right)-\frac{\partial
    L}{\partial q_j} = Q_j
\label{eq:euler-lagrange}
\end{equation}

El término $Q_j$ de la ecuación \ref{eq:euler-lagrange}, denominado fuerza generalizada
\citep{gavin2014}, consiste en el componente de la fuerza neta no conservativa del sistema que
realiza trabajo en la dirección de $q_j$, lo cual involucra las fuerzas externas y las disipativas.

Para poder utilizar las ecuaciones de Euler-Lagrange, es necesario que el sistema sea holonómico
\citep{vandiver2011}, lo que significa que la cantidad de coordenadas generalizadas a utilizar es
igual a la cantidad de grados de libertad del sistema.

La energía potencial y cinética que componen el Lagrangiano del sistema, dependen de factores como
el tipo de movimiento, la posición de los cuerpos y la constitución física de los mismos
(elasticidad). En el cuadro \ref{tab:energias}, se muestran algunos de los principales tipos de
dichas energías para sistemas mecánicos.

\begin{table}[]
\centering
\caption{Principales tipos de energías cinéticas y potenciales para un sistema mecánico}
\label{tab:energias}
\begin{tabular}{@{}ll@{}}
\toprule
\multicolumn{2}{l}{\textbf{Energía cinética (T)}} \\ \midrule
Traslacional & $\frac{1}{2} m {\left\lVert \vec{v} \right\rVert}^2  $   \\ \midrule
Rotacional & $\frac{1}{2} J {\omega}^2$ \\ \midrule
\multicolumn{2}{l}{\textbf{Energía potencial (V)}} \\ \midrule
Gravitacional & $mgh$ \\ \midrule
Elástica (Resorte) & $\frac{1}{2}k{x}^2$ \\ \bottomrule
\end{tabular}
\end{table}

\section{Modelado y simulación}
\subsection{Modelo cinemático}
\subsubsection{Modelo directo}


Para efectos de la obtención de este modelo se considera el centro del robot como el punto medio en el eje de las ruedas (también se le llama centro geométrico). La posición de este punto de describe por el vector $\mathbf{p_0}$. Se toma que cuando el robot está orientado hacia el eje x positivo, entonces su ángulo de orientación es $0^\circ$. Luego se define el ángulo de orientación $\theta$ como el medido a partir del eje x positivo. Como se muestra en la figura %ref

La posición de cada motor se decribe por los vectores $\mathbf{p_l}$ y $\mathbf{p_r}$ para el motor izquierdo y derecho respectivamente. Note que, utilizando álgebra de vectores, se puede deducir que: 

\begin{equation}
\begin{cases}
\mathbf{p_r}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c}\frac{b}{2}\cos(90^\circ-\theta(t))&  -\frac{b}{2}\sen(90^\circ-\theta(t))\end{array}\right]^t\\
\mathbf{p_l}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c}-\frac{b}{2}\cos(90^\circ-\theta(t))&  \frac{b}{2}\sen(90^\circ-\theta(t))\end{array}\right]^t
\end{cases}
\label{eq:global_position_prev_simplification}
\end{equation}


Note que $\cos(90^\circ-\theta(t))=\sen(\theta(t))$ y que $\sen(90^\circ-\theta(t))=\cos(\theta(t))$. Entonces, sustituyendo en (\ref{eq:global_position_prev_simplification}), se obtiene (\ref{eq:global_position}). 

\begin{equation}
\begin{cases}
\mathbf{p_r}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c} \frac{b}{2}\sen(\theta(t))&  -\frac{b}{2}\cos(\theta(t))\end{array} \right]^t\\
\mathbf{p_l}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c} -\frac{b}{2}\sen(\theta(t))&  \frac{b}{2}\cos(\theta(t))\end{array}\right]^t
\end{cases}
\label{eq:global_position}
\end{equation}

Se define que $\mathbf{p_0}(t)=\left[ \begin{array}{c c} x(t) & y(t) \end{array} \right]^t$, entonces tome $\dot{\mathbf{p_0}}(t)=\mathbf{v_0}(t)=\left[ \begin{array}{c c} \dot{x}(t) & \dot{y}(t) \end{array} \right]^t$ y $\dot{\theta}(t)=\omega(t)$. 

Derivando (\ref{eq:global_position})se obtiene:

\begin{equation}
\begin{cases}
\dot{\mathbf{p_r}}(t)=\mathbf{v_r}(t)=\mathbf{v_0}(t)+\left[  \begin{array}{c c} \frac{b}{2}\cos(\theta(t)) \omega(t) &  \frac{b}{2}\sen(\theta(t)) \omega(t) \end{array}\right]^t \\
\dot{\mathbf{p_l}}(t)=\mathbf{v_l}(t)=\mathbf{v_0}(t)+\left[  \begin{array}{c c}-\frac{b}{2}\cos(\theta(t)) \omega(t) & -\frac{b}{2}\sen(\theta(t)) \omega(t) \end{array}\right]^t
\end{cases}
\label{eq:global_velocities}
\end{equation}

Reescribiendo (\ref{eq:global_velocities}), pero sustituyendo que $\mathbf{v_n}=\left[ \begin{array}{c c} v_n\cos(\theta(t)) & v_n\sen(\theta(t)) \end{array} \right]^t$  en  (\ref{eq:velocities_system}) donde $|\mathbf{v_n}|=v_n$.

\begin{equation}
\begin{cases}
\begin{array}{c c c c c}
v_r\cos(\theta(t)) &=&v_0\cos(\theta(t))&+&\frac{b}{2}\cos(\theta(t))\omega(t)\\
v_r\sen(\theta(t)) &=&v_0\sen(\theta(t))&+&\frac{b}{2}\sen(\theta(t))\omega(t)\\
v_l\cos(\theta(t)) &=&v_0\cos(\theta(t))&+&\frac{b}{2}\cos(\theta(t))\omega(t)\\
v_l\sen(\theta(t)) &=&v_0\sen(\theta(t))&+&\frac{b}{2}\sen(\theta(t))\omega(t)
\end{array}
\end{cases}
\label{eq:velocities_system}
\end{equation}

De (\ref{eq:velocities_system}) suponga que $\cos(\theta(t))\neq 0$, entonces se concluye (\ref{eq:local_vel_wheels}) multiplicando por $1/\cos(\theta(t))$ a ambos lados de las ecuaciones. Si $\cos(\theta(t))= 0$, se sabe que $\sen(\theta(t))\neq 0$, y por tanto también se puede concluir (\ref{eq:local_vel_wheels}).

\begin{equation}
\begin{cases}
v_r(t)=v_0(t)+\frac{b}{2}\omega(t)\\
v_l(t)=v_0(t)-\frac{b}{2}\omega(t)
\end{cases}
\label{eq:local_vel_wheels}
\end{equation}

Note que como lo que se puede controlar es $\dot{\varphi}_r$ y $\dot{\varphi}_l$, las velociddes angulares de los motores derecho e izquierdo respectivamente. Entonces se despeja $v_0$ y $\omega(t)$ en términos de $v_r$ y $v_l$ y si se toma en consideración que el radio de las ruedas es $r$, se obtiene el resultado en (\ref{eq:local_vel}) y en (\ref{eq:local_dir}).

\begin{equation}
v_0(t) =\frac{r}{2}(\dot{\varphi}_r(t)+\dot{\varphi}_l(t))
\label{eq:local_vel}
\end{equation} 

\begin{equation}
\dot{\theta}(t)=\frac{r}{b}(\dot{\varphi}_r(t)-\dot{\varphi}_l(t))
\label{eq:local_dir}
\end{equation}

También es sabido que:
\begin{equation}
\mathbf{v_0}(t)=\left[ \begin{array}{c} \dot{x}(t) \\ \dot{y}(t) \end{array} \right]=\left[\begin{array}{c} v_0(t)\cos(\theta(t)) \\ v_0(t)\sen(\theta(t)) \end{array} \right]
\label{eq:global_vel}
\end{equation} 

Entonces, sustituyendo (\ref{eq:local_vel}) en (\ref{eq:global_vel}), y tomando en consideración (\ref{eq:local_dir}), se obtiene la ecuación descrita en (\ref{eq:kinematic_model_matrix}).

\begin{equation}
\left[
\begin{array}{c}
\dot{x}(t)\\\dot{y}(t)\\\omega(t)
\end{array}
\right]
=
\left[
\begin{array}{c c}
\frac{r}{2}\cos(\theta(t))&\frac{r}{2}\cos(\theta(t))\\
\frac{r}{2}\sen(\theta(t))&\frac{r}{2}\sen(\theta(t))\\
\frac{r}{b}&\frac{-r}{b}
\end{array}
\right]
\left[
\begin{array}{c}
\dot{\varphi}_r(t)\\ \dot{\varphi}_l(t)
\end{array}
\right]
\label{eq:kinematic_model_matrix}
\end{equation}

Se definen los siguientes vectores, para simplificar la notación de esta sección: $\nu(t)=\left[\begin{array}{c c c}\dot{x}(t)&\dot{y}(t)&\omega(t)\end{array}\right]^t$ y $\dot{\varphi}(t)=\left[\begin{array}{c c} \dot{\varphi}_r(t)& \dot{\varphi}_l(t) \end{array} \right]^t$. Se define $\Lambda(t)$, como la matriz en (\ref{eq:kinematic_model_matrix}). De esta menra de reescribe la ecuación como:

\begin{equation}
\mathbf{\nu}(t)=\Lambda(t) \mathbf{\dot{\varphi}}(t)
\label{eq:kinematic_model}
\end{equation}

La ecuación (\ref{eq:kinematic_model}) representa el modelo cinemático directo del sistema. Ya que relaciona la entrada ($\mathbf{\dot{\varphi}}(t)$), con la salida ($\mathbf{\nu}(t)$). %mismo resultado que Trajectory Tracking Control for a Differential Drive Wheeled Mobile Robot Considering the Dynamics Related to the Actuators and Power Stage

%\subsubsection{Modelo inverso}

%Para encontrar la cinemática inversa, es necesario encontrar las velocidades de las ruedas en términos de la velocidad del robot. Esto se logra computando la pseudoinversa de $\Lambda(t)$, que se denota por $\Lambda^{-1}(t)$. Se utiliza \textit{Wolfram Mathematica} para encontrar una expresión simbólica para $\Lambda^{-1}(t)$. El resultado se muestra en (\ref{eq:pseudoinverse}).

%\begin{equation}
%\Lambda^{-1}=\left[
%\begin{array}{c c c}
%\frac{\cos(\theta(t))}{r} & \frac{\cos(\theta(t))}{r} & \frac{b}{2r}\\
%\frac{\sen(\theta(t))}{r} & \frac{\sen(\theta(t))}{r} & \frac{-b}{2r}\\
%\end{array}
% \right]
%\label{eq:pseudoinverse}
%\end{equation}

%El modelo cinemático inverso viene dado por (\ref{eq:inverse_kinematic_model}):

%\begin{equation}
%\mathbf{\dot{\varphi}}(t)=\Lambda^{-1}\mathbf{\nu}(t)
%\label{eq:inverse_kinematic_model}
%\end{equation}

%La ecuación en (\ref{eq:inverse_kinematic_model}) muestra al vector de velocidades angulares en las ruedas en términos de la velocidad traslacional del centro geométrico del robot y la velocidad angular del robot. Sin embargo por la no holonomicidad %OJO hay que citar esto. No se puede simplemente decir qeu es no holonomico!·········
%del sistema, hay soluciones que no son posibles. Tome el caso en el que se requiera una velocidad traslacionar que sea perpendicular a la orientación actual del robot. Entonces se tiene $\theta(t)$ como la orientación actual. $(\cos(\theta(t)), \sen(\theta(t)))$, es un vector unitario en la dirección del robot. Entonces $\mathbf{v_{per}}(t)=(-\sen(\theta(t)),\cos(\theta(t)))$ es un vector perpendicular a la orientación del robot. Tome $\mathbf{\nu}_{\perp}(t)=\left[\begin{array}{c c c} -\sen(\theta(t))& \cos(\theta(t)) & 0\end{array} \right]^t$. Sutituyendo $\mathbf{\nu}_{\perp}(t)$ en (\label{eq:inverse_kinematic_model}), se obtiene una velocidad angular en las ruedas de $\mathbf{\dot{\varphi}}_{\perp}(t)=$.

%OJO hay que terminar esta parte IMPORTANTE. para justificvar utilizar el punto desplazado. 

\subsubsection{Modelo del punto descentralizado}

%Hacer la justificaciond e contrabilidad.

En algunos casos es más conveniente tomar un punto desplazado del centro del robot. Este normalmente se toma hacia el frente. Se calculan las velocidades de las ruedas para controlar la velocidad traslacional del punto desplazado (conocido en adelante como punto descentralizado). En este caso no se toma en cuenta la orientación, ya que este modelo se utiliza para un robot que usualmente se va a utilizar para seguir trayectorias. De esta manera se hace que el punto desplazado siga la trayectoria, y el centro del robot de manera natural va a seguir la trayectoria con la orientación adecuada. %citar esto que acabod e decir

Entonces considere el punto descentralizado, cuyo vector de posición es $\mathbf{p_d}(t)$. Se define que la distancia entre $\mathbf{p_d}(t)$ y $\mathbf{p_0}(t)$ es $d$. Note que $\mathbf{p_d}(t)$ está fijo en el marco de referencia del robot, entonces $d$ es constante. Se cumple lo descrito en (\ref{eq:punto_desplazado}).

\begin{equation}
\mathbf{p_d}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c} d\cos(\theta(t))&  d\sen(\theta(t))\end{array} \right]^t
\label{eq:punto_desplazado}
\end{equation}

Luego, derivando (\ref{eq:punto_desplazado}), se obtiene la expresión en (\ref{eq:vel_desplazado}).

\begin{equation}
\dot{\mathbf{p_d}}(t)=\dot{\mathbf{p_0}}(t)+\left[\begin{array}{c c} -d\sen(\theta(t))\omega(t)&  d\cos(\theta(t))\omega(t)\end{array} \right]^t
\label{eq:vel_desplazado}
\end{equation} 

Para expresar la velocidad en el punto descentralizado descrita en (\ref{eq:vel_desplazado}), se define $\Psi(t)$ en (\ref{eq:matriz_m}), la matriz de trasformación del punto central al punto descentralizado.

\begin{equation}
\dot{\mathbf{p_d}}(t)=\left[ \begin{array}{c c c} 1&  0& -d\sen(\theta(t))\\
                                                 0&  1&  d\cos(\theta(t))\end{array}  \right] \mathbf{\nu}(t)
=\Psi(t) \mathbf{\nu}(t)
\label{eq:matriz_m}
\end{equation} 


Ahora, se define $A(t)=\Psi(t)\Lambda(t)$, para obtener la relación entre $\dot{\mathbf{p_d}}(t)$, y $\mathbf{\dot{\varphi}}(t)$. Como se presenta en (\ref{eq:modelo_desplazado}).

\begin{equation}
\dot{\mathbf{p_d}}(t)= \left[ \begin{array}{c c} 0.5r\cos(\theta(t))-\frac{dr\sen(\theta(t))}{b}& 0.5\cos(\theta(t))+\frac{er\sen(\theta(t))}{b}  \\
                                                 -0.5r\sen(\theta(t))-\frac{dr\cos(\theta(t))}{b}& 0.5\sen(\theta(t))-\frac{dr\cos(\theta(t))}{b}  \end{array}  \right] \mathbf{\dot{\varphi}}(t)=A(t)\mathbf{\dot{\varphi}}(t)
\label{eq:modelo_desplazado}
\end{equation}

Se define a $\theta$ como el estado del sistema. Entonces la relación entrada-estado del modelo directo del punto descentralizado viene dada en (\ref{eq:local_dir}). Y la relación entrada-salida-estado viene dada en (\ref{eq:modelo_desplazado}). 

\subsubsection{Modelo inverso del punto descentralizado}

Para poder controlar al robot, se necesita el modelo inverso. Primero se debe determinar si es posible encontrarlo. Se tiene que $det(A)=-\frac{dr^2}{b}$, de manera que el determinante es no nulo para todo valor de $t$. Entonces siempre es posible encontrar la matriz inversa de $A(t)$, esta se denota por $A^{-1}(t)$, su resultado se muestra en (\ref{eq:a_inverso}). Para el modelo inverso, se tiene a $\mathbf{\dot{\varphi}}(t)$ como la salida, y a $\dot{\mathbf{p_d}}(t)$ como la entrada, pero el estado no cambia; $\theta(t)$ es el estado de este modelo. Entonces en (\ref{eq:desplazado_inverso}) se muestra la relación entre la entrada y la salida del modelo inverso. De sustituir (\ref{eq:local_dir}) en  (\ref{eq:desplazado_inverso}), se obtiene (\ref{eq:estado_entrada_desplazado}). Finalmente, el modelo cinemático inverso para el punto desplazado viene dado por las ecuaciones (\ref{eq:a_inverso}),(\ref{eq:estado_entrada_desplazado}) y (\ref{eq:desplazado_inverso}).

\begin{equation}
A^{-1}(t)=
\left[
\begin{array}{cc}
 \frac{ d \cos (\theta (t))-0.5 b \sen (\theta (t))}{d r} & \frac{0.5 b \cos
   (\theta (t))+ d \sen (\theta (t))}{d r} \\
 \frac{ d \cos (\theta (t))+0.5 b \sen (\theta (t))}{d r} & \frac{ d \sen
   (\theta (t))-0.5 b \cos (\theta (t))}{d r} \\
\end{array}
\right]
\label{eq:a_inverso}
\end{equation}

\begin{equation}
\mathbf{\dot{\varphi}}(t)=A^{-1}(t)\dot{\mathbf{p_d}}(t)
\label{eq:desplazado_inverso}
\end{equation}

\begin{equation}
\dot{\theta}(t)=\left[
\begin{array}{cc}
 \frac{b}{r} & \frac{-b}{r}
\end{array}
\right] A^{-1} \dot{\mathbf{p_d}}(t)
\label{eq:estado_entrada_desplazado}
\end{equation}


%Esta parte puede que desaparezca! ya no es tan relevante!****************************************************
%*************************************************************************************************************


%IMPORTANTE definir centro geometrico. Puede que sea distinto al punto medio entre las llantas!
Para analizar el comportamiento del centro geométrico del robot, y el punto desplazado, se debe encontrar una transformación que los relacione. De esta manera se puede verificar qeu al controlar el punto desplazado, se logra un control indirecto sobre el centro geométrico, y que la orientación del robot se adapta, conforme el robot avanza en la trayectoria. Sustituyendo (\ref{eq:kinematic_model}) en (\ref{eq:desplazado_inverso}) se obtiene (\ref{eq:desplazado_contra_centro}), que es la relación entre la velocidad en el punto desplazado (que se puede controlar) y el centro geométrico (sobre el qeu no se tiene control completo).

 \begin{equation}
\mathbf{\nu}(t)=\Lambda A^{-1}\dot{\mathbf{p_d}}(t)=
\left[
\begin{array}{cc}
 \cos^2(\theta(t)) & \cos(\theta(t))\sen(\theta(t))\\
 \cos(\theta(t))\sen(\theta(t))& \sen^2(\theta(t))\\
\frac{-\sen(\theta(t))}{d}&\frac{\cos(\theta(t))}{d}
\end{array}
\right] \dot{\mathbf{p_d}}(t)
\label{eq:desplazado_contra_centro}
\end{equation}

%Esta parte puede que desaparezca! ya no es tan relevante!****************************************************
%*************************************************************************************************************

\subsection{Modelo dinámico}
La obtención del modelo dinámico se fundamenta en la aplicación del método de Euler-Lagrange
considerando las restricciones propias del sistema del robot diferencial de dos ruedas. Se
consideran entonces las siguientes suposiciones:
\begin{itemize}
\item El robot no se desliza hacia los lados, de modo que solo se puede desplazar en la dirección
  definida por el frente del mismo.
\item La rapidez traslacional del robot sobre el punto en donde se ubica cada rueda, es igual a la
  rapidez tangencial de la rueda respectiva en contacto con el suelo, lo cual corresponde a la
  condición de rodadura.
\item El robot sólamente puede perder energía debido a la fricción en los ejes de cada rueda, la
  cual se considera viscosa para simplificar la obtención del modelo.
\item El movimiento que describe el robot se lleva a cabo sobre una superficie plana, de manera que
  no hay cambios energéticos debidos a la acción del campo gravitacional terrestre sobre el robot.
\item El cuerpo del vehículo es no deformable, de modo que no se acumula energía potencial debido a
  elasticidad ni se dan pérdidas de energía debido a la deformación de las llantas o el cuerpo del
  robot.
\item No se consideran las limitaciones relacionadas con la potencia máxima que pueden entregar los motores
  de cada rueda, de manera que los mismos pueden generar pares de torsión muy grandes que cambian de
  manera abrupta. %REVISAR!!!!!!!!!! 
  % \item La distribución de masa del robot es simétrica con respecto a la línea central definida por el
  % frente del vehículo, de manera que tanto el centro de masa como el centro geométrico se encuentran
  % sobre dicha línea.  
\item El cuerpo del robot no se comporta como un péndulo invertido, ya que presenta el soporte
  adecuado para mantenerse estable sin balancearse.
\end{itemize}

A partir de la condición de no deslizamiento hacia los lados, se obtiene que el componente de la
velocidad traslacional del centro geométrico que es perpendicular a la recta descrita por el frente del
robot (definida por el ángulo de orientación $\theta(t)$), es nulo, lo cual se muestra en (\ref{eq:restriccion_1}).

\begin{equation}
\label{eq:restriccion_1}
f_1  =  \dot{x}(t)sen(\theta(t)) -\dot{y}(t)cos(\theta(t)) = 0 
\end{equation}


Para la rueda derecha, se tiene que la magnitud de su velocidad tangencial es la mostrada en
(\ref{eq:vel_tan_rueda_r}).
\begin{equation}
  \label{eq:vel_tan_rueda_r}
  v_{Tr}(t) = r\dot{\varphi_r}(t)
\end{equation}

En donde $r$ es el radio de cada rueda y $\dot{\varphi_r}(t)$ es la velocidad angular de un punto de
la rueda derecha.

Por otro lado, la magnitud de la velocidad traslacional del punto en donde se encuentra ubicada la
rueda derecha sobre el vehículo corresponde a la expresión de (\ref{eq:vel_tras_rueda_r}).

\begin{equation}
  \label{eq:vel_tras_rueda_r}
  v_{Pr}(t)=\dot{x}(t)\cos(\theta(t))+\dot{y}(t)\sen(\theta(t))+b\dot{\theta}(t)
\end{equation}
 

En donde el término $\dot{x}(t)\cos(\theta(t))+\dot{y}(t)\sen(\theta(t))$ es la rapidez traslacional
del centro del vehículo, y el término $b\dot{\theta}(t)$ corresponde al aporte en la velocidad dado
por la rotación del robot, el cual se suma porque el giro en la dirección positiva de incremento de
$\theta(t)$ (contraria a las manecillas del reloj) favorece el movimiento hacia adelante de la rueda
derecha. De la restricción de rodamiento de las ruedas, se tiene que $v_{Tr}=v_{Pr}$, lo cual se
muestra en (\ref{eq:restriccion_2}).

\begin{equation}
\label{eq:restriccion_2}
f_2 =  \dot{x}(t)cos(\theta(t)) + \dot{y}(t)sen(\theta(t)) + b \dot{\theta}(t) - r \dot{\varphi_{r}}(t) = 0 \\
\end{equation}

De manera análoga, se tiene que la velocidad tangencial de la rueda izquierda corresponde a
(\ref{eq:vel_tan_rueda_l}), y que la velocidad traslacional del punto en donde se encuentra ubicada
dicha rueda es la mostrada en (\ref{eq:vel_tras_rueda_l}).

\begin{equation}
  \label{eq:vel_tan_rueda_l}
  v_{Tl}(t) = r\dot{\varphi_l}(t) 
\end{equation}

\begin{equation}
  \label{eq:vel_tras_rueda_l}
  v_{Pr}(t)=\dot{x}(t)\cos(\theta(t))+\dot{y}(t)\sen(\theta(t))-b\dot{\theta}(t)
\end{equation}


En donde el aporte en la velocidad dada por la rotación del robot $b\dot{\theta}(t)$, se resta
porque el giro en la dirección positiva de incremento de $\theta(t)$ se opone al movimiento hacia
adelante de la rueda izquierda. De la misma forma que para la rueda derecha, la restricción de
rodamiento implica que se cumple que $v_{Tl}=v_{Pl}$, lo cual se presenta en (\ref{eq:restriccion_3}).

\begin{equation}
\label{eq:restriccion_3}
f_3  =  \dot{x}(t)cos(\theta(t)) + \dot{y}(t)sen(\theta(t)) - b \dot{\theta}(t) - r \dot{\varphi_{l}}(t) = 0 \\
\end{equation}



Con respecto a las restricciones descritas por las ecuaciones (\ref{eq:restriccion_1}),
(\ref{eq:restriccion_2}) y (\ref{eq:restriccion_3}), denominadas $f_1$, $f_2$ y $f_3$
respectivamente, se conoce que las mismas corresponden a restricciones no holonómicas (***Sarkar),
ya que establecen condiciones sobre las derivadas de las coordenadas generalizadas a utilizar para
el método de Euler-Lagrange, las cuales corresponden a $x(t)$, $y(t)$, $\theta(t)$, $\varphi_r(t)$ y
$\varphi_l(t)$.

Estas restricciones no holonómicas están asociadas a fuerzas generalizadas que mantienen el
movimiento bajo dichas condiciones (***REF), las cuales dependen de multiplicadores de Lagrange
tal como se muestra en la ecuación (***), y que en este caso son $\lambda_1$, $\lambda_2$ y
$\lambda_3$, correspondientes a $f_1$, $f_2$ y $f_3$ respectivamente. Dichas fuerzas generalizadas
modifican la ecuación de Lagrange para cada coordenada, tal como se describe en la ecuación (***) y
de las cuales se obtendrá el modelo en variables de estado.

Para el método de Lagrange, se tiene en primer lugar que la energía potencial asociada al sistema es
constante, ya que el centro de masa del robot se mueve en un plano horizontal y no se consideran las
posibles deformaciones elásticas del vehículo, ni tampoco se presenta el comportamiento de péndulo
invertido. De esta forma, el término que está asociado al cambio en la energía potencial en la
ecuación de Lagrange (***Lagrange+Restricciones) para cada coordenada es cero
($\frac{\partial U}{\partial q_i} = 0$), de lo que se obtiene la ecuación
(\ref{eq:lagrange_restrict_final}), la cual se utilizará para la obtención de las ecuaciones del
movimiento del sistema.

\begin{equation}
  \frac{d}{dt}\left( \frac{\partial K}{\partial \dot{q_i}}\right) - \frac{\partial K}{\partial
    q_i} = Q_i + \sum_{k=1}^3 \lambda_k \frac{\partial f_k}{\partial \dot{q_i}}
  \label{eq:lagrange_restrict_final}
\end{equation}

De esta forma, se procede a obtener la energía cinética total del sistema, así como las fuerzas
generalizadas correspondientes a cada coordenada, para luego obtener las ecuaciones del movimiento
correspondientes.

En primer lugar, si se estudia el movimiento del cuerpo del vehículo sin las ruedas (de masa $m_c$),
se puede calcular la energía cinética correspondiente a esta porción del robot. Para el componente
traslacional, se considera que dicho cuerpo sólido es equivalente a una partícula de masa $m_c$ que
se encuentra ubicada en el centro de masa del cuerpo, localizado a una distancia $s$ en línea recta
con el centro geométrico del robot, el cual se toma en medio de las dos ruedas. %Referenciar
                                %imagen
Se tiene entonces que la posición que permite ubicar al centro de masa es la mostrada en
(\ref{eq:posición_carrito}). De dicho punto se puede obtener la velocidad del centro de masa
(\ref{eq:vel_centro_masa}), a partir de la cual se obtiene la energía cinética traslacional, que
corresponde a la expresión de (\ref{eq:k_tras_cuerpo}).

\begin{equation}
\mathbf{p_g}(t) = \left[ \begin{array}{c}
x_g(t) \\ y_g(t) \end{array} \right] = \left[ \begin{array}{c} x(t) + s \cos \left( \theta(t) \right)\\
 y(t) + s \sen\left( \theta(t) \right) \end{array} \right]
\label{eq:posición_carrito}
\end{equation}


\begin{equation}
 \mathbf{\dot{p_g}}(t)= \left[ \begin{array}{c} \dot{x_g}(t) \\ \dot{y_g}(t) \end{array} \right] = \left[
    \begin{array}{c} \dot{x}(t)-s\sen(\theta(t))\dot{\theta}(t) \\ \dot{y}(t)+s\cos(\theta(t))\dot{\theta}(t) \end{array} \right]
  \label{eq:vel_centro_masa}  
\end{equation}

\begin{equation}
  \label{eq:k_tras_cuerpo}
  K_{Ctr} = \frac{1}{2}m_c \left\lVert \mathbf{\dot{p_g}}\right\rVert^2 = \frac{1}{2}m_c \left( \dot{x_g}(t)^2 + \dot{y_g}(t)^2 \right)
\end{equation}

Para el componente rotacional, se tiene que la energía cinética asociada al cuerpo
corresponde a la rotación relacionada con $\theta(t)$ alrededor del centro de masa como
eje (en donde se tiene un  momento de inercia $I_g$), ya que este punto se toma como referencia para la
obtención de la energía total del cuerpo (traslacional y rotacional). De esta forma, la energía
cinética rotacional del cuerpo corresponde a la ecuación (\ref{eq:k_rot_cuerpo}).

\begin{equation}
  \label{eq:k_rot_cuerpo}
  K_{Cro} = \frac{1}{2}I_g\dot{\theta}(t)^2
\end{equation}

Al sumar las energías cinéticas de las ecuaciones (\ref{eq:k_tras_cuerpo}) y
(\ref{eq:k_rot_cuerpo}), se obtiene la energía cinética del cuerpo del vehículo, tal como se muestra
en (\ref{eq:K_carrito}), en donde se sustituyeron las variables $\dot{x_g}(t)$ y $\dot{y_g}(t)$ en términos de
$x(t)$, $y(t)$ y $\theta(t)$, para luego simplificar algebraicamente la expresión.


\begin{equation}
  \begin{aligned}
    K_c = &\frac{1}{2} m_c \left[ \dot{x}(t)^2 + \dot{y}(t)^2 - 2s \dot{\theta}(t) \left( \dot{x}(t) \sen
        (\theta(t)) - \dot{y}(t) \cos( \theta(t)) \right) + s^2
      \dot{\theta}(t)^2 \right] \\ & + \frac{1}{2} I_g \dot{ \theta}(t)  
  \end{aligned}
  \label{eq:K_carrito}
\end{equation}


Para calcular la energía cinética asociada a la rueda derecha de masa $m_w$, se obtiene en primer
lugar la expresión para la posición de dicha rueda, a partir de la constitución geométrica del
vehículo, lo cual se muestra en la ecuación (\ref{eq:pos_rueda_r}).

\begin{equation}
  \label{eq:pos_rueda_r}
  \mathbf{p_r}(t)= \left[ \begin{array}{c} x_r(t) \\ y_r(t) \end{array} \right] = \left[
    \begin{array}{c} x(t)+b\sen(\theta(t)) \\ y(t)-b\cos(\theta(t)) \end{array} \right]
\end{equation}


A partir de posición de la rueda derecha, se calcula el vector de velocidad asociado
$\mathbf{\dot{p_r}}(t)$, con el cual se obtiene la energía cinética traslacional de esta rueda, la
cual se expresa en la ecuación (\ref{eq:k_tras_rueda_r}).

\begin{equation}
  \label{eq:k_tras_rueda_r}
  K_{Rtr}=\frac{1}{2}m_w\left(\dot{x_r}(t)^2 + \dot{y_r}(t)^2\right)
\end{equation}

Con respecto al componente de energía cinética rotacional, es importante notar que esta rueda gira
tanto por la rotación sobre su eje central $\dot{\varphi_r}(t)$, asociada a $I_w$, como debido al
cambio en la orientación del robot $\dot{\theta}(t)$, en donde se tiene que la rueda gira sobre un
eje definido por un diámetro, lo cual corresponde al momento de inercia $I_m$. De esta manera, se
obtiene la energía cinética rotacional de la rueda derecha tal como se muestra en la ecuación
(\ref{eq:k_rot_rueda_r}).

\begin{equation}
  \label{eq:k_rot_rueda_r}
  K_{Rro}= \frac{1}{2}I_w\dot{\varphi_r}(t)^2 + \frac{1}{2}I_m\dot{\theta}(t)^2
\end{equation}

De esta manera, al sumar las energías cinéticas de las ecuaciones (\ref{eq:k_tras_rueda_r}) y
(\ref{eq:k_rot_rueda_r}), y sustituyendo las variables $\dot{x_r}$ y $\dot{y_r}$ en términos de
$x(t)$, $y(t)$ y $\theta(t)$, se obtiene la energía cinética total de la rueda derecha, la cual se
presenta en la ecuación (\ref{eq:K_rueda derecha}).

\begin{equation}
\label{eq:K_rueda derecha}
  \begin{aligned}
    K_r= &\frac{1}{2}m_{w}\left[ \dot{x}(t)^2 + \dot{y}(t)^2 + 2b \dot{\theta}(t) \left( \dot{x}(t)
        \cos( \theta(t)) + \dot{y}(t) \sen \left( \theta(t) \right)\right) + b^2 \dot{\theta}(t)^2
    \right] \\ 
    & + \frac{1}{2} I_m  \dot{\theta}(t)^2 + \frac{1}{2} I_{w} \dot{\varphi_r}(t)^2
  \end{aligned}
\end{equation}


De manera análoga, a partir de la expresión para el vector de posición de la rueda izquierda
mostrada en la ecuación (\ref{eq:pos_rueda_l}), en conjunto con el mismo análisis realizado para la
obtención de la energía cinética en la rueda derecha, se llega a la energía cinética total de la
rueda izquierda, mostrada en la ecuación (\ref{eq:K_rueda izquierda}).

\begin{equation}
  \label{eq:pos_rueda_l}
  \mathbf{p_l}(t)= \left[ \begin{array}{c} x_l(t) \\ y_l(t) \end{array} \right] = \left[
    \begin{array}{c} x(t)-b\sen(\theta(t)) \\ y(t)+b\cos(\theta(t)) \end{array} \right]
\end{equation}


\begin{equation}
\label{eq:K_rueda izquierda}
\begin{aligned}
K_l= &\frac{1}{2}m_{w}\left[ \dot{x}(t)^2 + \dot{y}(t)^2 - 2b \dot{\theta}(t) \left( \dot{x}(t) \cos \left(
      \theta(t) \right) + \dot{y}(t)\sen \left( \theta(t) \right)\right) + b^2 \dot{\theta}(t)^2 \right] \\ & +
\frac{1}{2} I_m  \dot{\theta}(t)^2  + \frac{1}{2} I_{w} \dot{\varphi_l}(t)^2
\end{aligned}
\end{equation}


A partir de las energías del cuerpo del robot y de las ruedas, se obtiene la energía cinética total
del sistema como $K_t = K_c + K_r + K_l $, de lo cual al simplificar algebraicamente los términos se
obtiene la ecuación (\ref{eq:k_total}).

\begin{equation}
\label{eq:k_total}
\begin{aligned}
K_t = &
 \frac{1}{2} \left(m_c + 2m_{w} \right) \left[\dot{x}(t)^2+\dot{y}(t)^2 \right] - m_c s
 \dot{\theta}(t) \left[\dot{x}(t)\sen(\theta(t)) - \dot{y}(t)\cos (\theta(t)) \right] \\ 
 &  + \frac{1}{2} \left(m_c s^2 + I_g + 2m_{w}b^2 + 2 I_m \right) \dot{\theta}(t)^2 + \frac{1}{2} I_{w}\dot{\varphi_{r}}(t)^2 + \frac{1}{2} I_{w}\dot{\varphi_{l}}(t)^2
\end{aligned}
\end{equation}

Si se establecen las definiciones descritas por (\ref{eq:def_m_I}), la ecuación (\ref{eq:k_total}) se simplifica
obteniéndose la expresión de (\ref{eq:k_total_simpl}).


\begin{equation}
\begin{cases}
\begin{array}{c c c}
m &=& m_c + 2m_{w} \\
I &=& I_g+m_c s^2 + 2m_{w}b^2 + 2 I_m 
\end{array}
\end{cases}
\label{eq:def_m_I}
\end{equation}


\begin{equation}
\label{eq:k_total_simpl}
\begin{aligned}
K_t = &
\frac{1}{2} m \left(\dot{x}(t)^2+\dot{y}(t)^2 \right) + m_c s \dot{\theta}(t) \left(\dot{y}(t)\cos
  \left(\theta(t) \right) - \dot{x}(t)\sen \left(\theta(t) \right) \right) \\ & + \frac{1}{2} I \dot{\theta}(t)^2 + \frac{1}{2} I_{w}\left(\dot{\varphi_{r}}(t)^2 + \dot{\varphi_{l}}(t)^2 \right)
\end{aligned}
\end{equation}


A continuación, para obtener las ecuaciones del movimiento se expresa la ecuación de Lagrange
respectiva para cada coordenada (\ref{eq:ecuaciones_lagrange}). De esta forma, para cada una de ellas se calculan los
términos relacionados con la energía cinética a partir de la ecuación (\ref{eq:k_total_simpl}), la
fuerza generalizada, y la sumatoria de términos correspondientes a las restricciones del movimiento
descritas por las ecuaciones (\ref{eq:restriccion_1}), (\ref{eq:restriccion_2}) y
(\ref{eq:restriccion_3}).

\begin{equation}
\begin{cases}
\begin{array}{c c c c c}
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{x}}\right) - \frac{\partial K_t}{\partial x} -
  \sum_{k=1}^³  \lambda_k\frac{\partial f_k}{\partial \dot{x}} &=& Q_x\\
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{y}}\right) - \frac{\partial K_t}{\partial y} -
  \sum_{k=1}^³ \lambda_k \frac{\ \partial f_k}{\partial \dot{y}} &=& Q_y\\
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{\theta}}\right) - \frac{\partial K_t}{\partial \theta} -
  \sum_{k=1}^³ \lambda_k\frac{\partial f_k}{\partial \dot{\theta}} &=& Q_{\theta}\\
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{\varphi_r}}\right) - \frac{\partial K_t}{\partial \varphi_r} -
  \sum_{k=1}^³ \lambda_k \frac{\partial f_k}{\partial \dot{\varphi_r}} &=& Q_{\varphi_r}\\
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{\varphi_l}}\right) - \frac{\partial K_t}{\partial \varphi_l} -
  \sum_{k=1}^³ \lambda_k \frac{\partial f_k}{\partial \dot{\varphi_l}} &=& Q_{\varphi_l}\\
\end{array}
\end{cases}
\label{eq:ecuaciones_lagrange}
\end{equation}

Con respecto a las fuerzas generalizadas, que corresponden a factores externos que modifican la
energía del sistema, se tiene que para las coordenadas $x(t)$, $y(t)$ y $\theta(t)$ estas fuerzas
son nulas, ya que no hay ningún factor externo que modifique la energía del sistema por medio de
dichas coordenadas (no hay trabajo realizado sobre el sistema por medio de estas).

Sin embargo, para las coordenadas $\varphi_r(t)$ y $\varphi_l(t)$, existe respectivamente un torque
neto en cada rueda que modifica la energía del sistema al variar dichas posiciones angulares
(***REF), ya que un par de torsión aplicado sobre un cuerpo que se mueve con cierta rapidez angular
implica que está presente una potencia mecánica. Por esta razón, se cumple que
$Q_{\varphi_r}=\tau_r(t)$ y $Q_{\varphi_l}=\tau_l(t)$.

Al calcular los términos indicados para cada coordenada en (\ref{eq:ecuaciones_lagrange}), se
obtiene un sistema de ecuaciones diferenciales no lineal en donde es necesario encontrar (o
eliminar) los multiplicadores de Lagrange $\lambda_1$, $\lambda_2$ y $\lambda_3$. El sistema de
ecuaciones resultante se muestra en (\ref{eq:sistema_lagrange}), en donde se omiten los subíndices
t. Se procederá entonces a eliminar dichas incógnitas.

\begin{subequations}
  \label{eq:sistema_lagrange}
  \begin{empheq}[left = \empheqlbrace]{align}
& m\ddot{x} - \ m_c s \left(\ddot{\theta} \sen \left( \theta \right) + \theta^2 \cos \left( \theta
  \right) \right) - \lambda_1 \sen \left( \theta \right) - \left( \lambda_2 + \lambda_3 \right) \cos
\left( \theta \right) = 0 \label{eq:sist_lagrange_x}\\
& m\ddot{y} + m_c s \left(\ddot{\theta}\cos\left(\theta \right) - \theta^2 \cos \left(\theta \right)
 \right) + \lambda_1 \cos \left(\theta \right) - \left(\lambda_2+\lambda_3\right)\sen\left(\theta\right) = 0 \label{eq:sist_lagrange_y}\\
& -m_c s \left( \ddot{x} \sen\left(\theta\right) - \ddot{y}\cos\left(\theta\right) \right) +
I\ddot{\theta} + b\left(\lambda_3-\lambda_2\right) = 0 \label{eq:sist_lagrange_theta}\\
& I_{w}\ddot{\varphi_r}+\lambda_2 r = \tau_r \label{eq:sist_lagrange_phi_r}\\
& I_{w}\ddot{\varphi_l}+\lambda_3 r = \tau_l \label{eq:sist_lagrange_phi_l}
  \end{empheq}
\end{subequations}

Al multiplicar la ecuación (\ref{eq:sist_lagrange_x}) por $\cos(\theta(t))$ y al sumarle la ecuación (\ref{eq:sist_lagrange_y}) multiplicada
por $\sen(\theta(t))$, se obtiene (\ref{eq:ec_mov_1}) al simplificar la expresión algebraica.

\begin{equation}
\label{eq:ec_mov_1}
m\left(\ddot{x}(t)\cos\left(\theta\right)+\ddot{y}(t)\sen\left(\theta(t)\right) \right) - m_c s
\dot{\theta}(t)^2-\left(\lambda_2 + \lambda_3\right) = 0
\end{equation}

Sumando las ecuaciones (\ref{eq:sist_lagrange_phi_r}) y (\ref{eq:sist_lagrange_phi_l}), se obtiene la expresión para $\lambda_2+\lambda_3$ que se
muestra en la ecuación (\ref{eq:lambda2+3}).

\begin{equation}
\label{eq:lambda2+3}
\lambda_2 + \lambda_3 = \frac{\tau_l(t) + \tau_r(t)}{r} - \frac{I_{w}}{R} \left(\ddot{\varphi_r}(t)+\ddot{\varphi_l}(t)\right)
\end{equation}


Se define la expresión de la ecuación (\ref{eq:vel_tras_robot}), la cual corresponde a la magnitud de
la velocidad traslacional del vehículo, y que además está restringida a presentar la dirección sobre
la línea definida por $\theta(t)$.

\begin{equation}
  \label{eq:vel_tras_robot}
  v(t)=\dot{x}(t)cos(\theta(t))+\dot{y}(t)sen(\theta(t))
\end{equation}

Derivando la ecuación (\ref{eq:vel_tras_robot}), se calcula una expresión para la aceleración
traslacional del robot, la cual se simplifica a la ecuación mostrada en (\ref{eq:acel_tras_robot}), al aplicar la
condición de no deslizamiento lateral descrita por (\ref{eq:restriccion_1}).

\begin{equation}
  \label{eq:acel_tras_robot}
  \dot{v}(t) = \ddot{x}(t)cos(\theta(t)) + \ddot{y}(t)\sen(\theta(t))
\end{equation}

Al sustituir (\ref{eq:lambda2+3}) y (\ref{eq:acel_tras_robot}) en (\ref{eq:ec_mov_1}), se obtiene la
ecuación del movimiento (\ref{eq:ec_mov_1_simpl_1}), en la cual se lograron eliminar los
multiplicadores de Lagrange.

\begin{equation}
\label{eq:ec_mov_1_simpl_1}
m\dot{v}(t) - m_c s \dot{\theta}(t)^2 + \frac{I_{w}}{r} \left(\ddot{\varphi_r}(t)+\ddot{\varphi_l}(t)\right) = \frac{\tau_l(t)+\tau_r(t)}{r}
\end{equation}

Por otro lado, al restar las ecuaciones (\ref{eq:sist_lagrange_phi_l}) y
(\ref{eq:sist_lagrange_phi_r}) se obtiene una expresión para $\lambda_3-\lambda_2$, la cual se
presenta en (\ref{eq:lambda3-2}).

\begin{equation}
\label{eq:lambda3-2}
\lambda_3 - \lambda_2 = \frac{I_{w}}{r} \left(\ddot{\varphi_r}(t)-\ddot{\varphi_l}(t)\right)-\frac{\tau_r(t)-\tau_l(t)}{r}
\end{equation}

Sustituyendo (\ref{eq:lambda3-2}) en (\ref{eq:sist_lagrange_theta}), se llega a la ecuación del
movimiento (\ref{eq:ec_mov_2_simpl_1}), en donde también se eliminaron los multiplicadores de Lagrange.


\begin{equation}
\label{eq:ec_mov_2_simpl_1}
\begin{aligned}
  &I\ddot{\theta}(t) -m_c s \left(\ddot{x}(t)\sen\left(\theta(t)\right) -\ddot{y}(t)
    \cos\left(\theta(t)\right)\right) +\frac{bI_{w}}{r}\left(\ddot{\varphi_r}(t)
    -\ddot{\varphi_l}(t)\right) \\ & = \frac{b \left(\tau_r(t)-\tau_l(t) \right)}{r}
\end{aligned}
\end{equation}


Para simplificar aún más las ecuaciones del movimiento, se utilizan las ecuaciones de las
restricciones de la condición de rodadura para cada llanta, que corresponden a
(\ref{eq:restriccion_2}) y (\ref{eq:restriccion_3}). Al sumar dichas ecuaciones y derivar el
resultado, se obtiene (\ref{eq:ddphi_r+ddphi_l}), mientras que al restar estas ecuaciones y al
derivar la expresión obtenida, se llega a la ecuación (\ref{eq:ddphi_r-ddphi_l}). Por otro lado, al
derivar la ecuación de la restricción de no deslizamiento lateral (\ref{eq:restriccion_1}), se
obtiene la expresión mostrada en (\ref{eq:wv}).

\begin{equation}
\label{eq:ddphi_r+ddphi_l}
\ddot{\varphi_r}(t) + \ddot{\varphi_l}(t) = \frac{2}{r} \dot{v}(t)
\end{equation}

\begin{equation}
\label{eq:ddphi_r-ddphi_l}
\ddot{\varphi_r}(t) - \ddot{\varphi_l}(t) = \frac{2b}{r} \ddot{\theta}(t)
\end{equation}

\begin{equation}
  \label{eq:wv}
  -\dot{\theta}(t)v(t) =
  \ddot{x}(t)\sin\left(\theta(t)\right)-\ddot{y}(t)\cos\left(\theta(t)\right)
\end{equation}

También, se definen las expresiones mostradas en (\ref{eq:FyT}), que pueden interpretarse
respectivamente como la fuerza ($F$) y el torque ($T$) totales externos aplicados sobre el sistema,
los cuales son producidos por los torques netos en las ruedas.

\begin{equation}
\begin{cases}
\begin{array}{c c c}
F(t) &=& \frac{\tau_r(t) + \tau_l(t)}{r} \\
T(t) &=& \frac{b}{r}\left( \tau_r(t) - \tau_l(t) \right)
\end{array}
\end{cases}
\label{eq:FyT}
\end{equation}


Al sustituir (\ref{eq:ddphi_r+ddphi_l}) y (\ref{eq:FyT}) en (\ref{eq:ec_mov_1_simpl_1}), y al
sustituir (\ref{eq:ddphi_r-ddphi_l}) y (\ref{eq:FyT}) en (\ref{eq:ec_mov_2_simpl_1}), se obtienen
las ecuaciones (\ref{eq:v_dot}) y (\ref{eq:omega_dot}) respectivamente, las cuales describen el
comportamiento dinámico del sistema sujeto a las restricciones impuestas. En donde se define
$D = m + \frac{2I_{w}}{r^2}$ y $J = m + 2\frac{I_{w}}{r^2}$, los cuales se pueden interpretar como
la masa y el momento de inercia equivalentes del sistema, respectivamente.

\begin{subequations}
  \label{eq:ecs_dinamicas}
  \begin{empheq}[left = \empheqlbrace]{align}
& D\ddot{v}(t) -m_c s\ddot{\theta}(t)^2 = F(t) \label{eq:v_dot}\\
& J\ddot{\theta}(t)+m_cs\dot{\theta}(t)v(t) = T(t) \label{eq:omega_dot}
  \end{empheq}
\end{subequations}


Se define entonces el vector de estados, el cual se muestra en la ecuación (\ref{eq:vect_estados}).

\begin{equation}
  \label{eq:vect_estados}
  \mathbf{X}(t)= \left[ \begin{array}{c} x(t) \\ y(t) \\ \theta(t) \\ v(t) \\ \omega(t) \\ \varphi_r(t) \\ \varphi_l(t) \end{array} \right]
\end{equation}

De esta manera, se presenta el modelo en variables de estado dinámico del sistema en
(\ref{eq:mve_dinamico}), en donde las ecuaciones (\ref{eq:x_dot_mve}) y (\ref{eq:y_dot_mve})
corresponden a los componentes de la velocidad del centro geométrico en los ejes cartesianos, la
ecuación (\ref{eq:theta_dot_mve}) resulta de la definición de la rapidez angular de cambio en la
orientación del vehículo $\omega(t)$, las ecuaciones (\ref{eq:v_dot_mve}) y (\ref{eq:omega_dot_mve})
se obtienen del análisis dinámico del sistema descrito previamente, y las ecuaciones
(\ref{eq:phi_r_dot_mve}) y (\ref{eq:phi_l_dot_mve}) se obtienen de las restricciones
correspondientes a (\ref{eq:restriccion_2}) y (\ref{eq:restriccion_3}) en términos de los estados definidos.

\begin{subequations}
  \label{eq:mve_dinamico}
  \begin{empheq}[left = \empheqlbrace]{align}
& \dot{x}(t) = v(t)\cos\left(\theta(t)\right) \label{eq:x_dot_mve}\\
& \dot{y}(t) = v(t)\sin\left(\theta(t)\right) \label{eq:y_dot_mve}\\
& \dot{\theta}(t) = \omega(t)\label{eq:theta_dot_mve}\\
& \dot{v}(t)=\frac{m_c s}{D} \omega(t)^2 + \frac{F(t)}{D} \label{eq:v_dot_mve}\\
& \dot{\omega}(t) = \frac{-m_c s}{J}\omega(t) v(t) + \frac{T(t)}{J} \label{eq:omega_dot_mve}\\
& \dot{\varphi_r}(t) =\frac{v(t)}{r} + \frac{b}{r} \omega(t) \label{eq:phi_r_dot_mve}\\
& \dot{\varphi_l}(t)= \frac{v(t)}{r} - \frac{b}{r} \omega(t) \label{eq:phi_l_dot_mve}
\end{empheq}
\end{subequations}


% Modelado de la fricción


\section{Análisis}




\section{Conclusiones y Recomendaciones}

Se logró exitosamente simular el sistema descrito. En las simulaciones se obtienen los resultados observados en el sistema real.


\section{Apéndice Ecuaciones}



\begin{equation}
\label{eq:mul_lagrange}
\frac{d}{dt}\left(\frac{\partial k}{\partial \dot{q_1(t)}}\right) - \left(\frac{\partial k}{\partial q_1(t)}\right)= \left(\frac{\partial U}{\partial q_1(t)}\right) + \sum  \frac{\lambda \partial f_i}{\partial \dot{q_1}(t)}
\end{equation}


\begin{eqnarray}
I_c = 15.625 Kg.m^2\\
I_{\omega}= 0.005 kg.m^2\\
I_m = 0.0025 kg. m^2\\
b = 0.75
d = s = 0.3 m\\
m_c = 30 kg\\
m_{\omega} = 1 kg\\
r = 0.10m
\end{eqnarray}


\newpage
%-------------------
%bibliografía
\addcontentsline{toc}{section}{Bibliografía}
\bibliographystyle{EIEBib}
\bibliography{informe_ref}
%nombre del archivo .bib que contiene la bibliografía


% ------------------- archivo de apéndice si fuera necesario (* si no hay apéndice comentar las
% siguientes dos líneas *)

%\addcontentsline{toc}{section}{Apéndices}

%------------------
%final del documento
\end{document}
% Lo que se escriba a partir de aquí será ignorado por el compilador