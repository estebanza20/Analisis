%Archivo de muestra de un Informe de práctica o laboratorio
% utilizando la clase eieinforme.cls (V.M. Alfaro)
%---------------------------------------------------------------------

%preámbulo - uso de la clase eieinforme
\documentclass{eieinforme}
%
%--------- <Agregue aquí algún paquete extra que sea necesario---------
\usepackage{booktabs}
\usepackage{url}
\usepackage{empheq}
\usepackage{subcaption}
\usepackage[justification=centering]{caption}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage[spanish]{babel}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=black,      
    urlcolor=black,
}

\usepackage{helvet}
\usepackage{amsmath,amsfonts,amssymb,commath}
\usepackage{color}
\usepackage{xcolor}
\usepackage{verbatim}
\usepackage{tabls}
\usepackage[space]{grffile}
\usepackage{listings}

\usepackage{siunitx}

\usepackage{matlab-prettifier}

\usepackage{textcomp} 
\usepackage{pdfpages}   %incluir paginas de pdf externo, para los anexos
\usepackage{caption} 
\usepackage{rotating}
\usepackage[section]{placeins}
\usepackage{tikz}

%--------- Agregue aquí algún paquete extra que sea necesario>---------
%
\begin{document}
\pagenumbering{roman}

%------------ Desde aquí datos de la portada ------------------%

%título de la práctica (* Por el usuario *)
\title{Proyecto final:\\ Modelado del comportamiento de los robots de dos ruedas}

%nombre del curso (* Por el usuario *)
\curso{IE-0409 Análisis de Sistemas}

%nombre completo de los autores (* Por el usuario *)
\autorA{Ariel Fallas Pizarro, B42481}
\autorB{Daniel García Vaglio, B42781}
\autorC{Esteban Zamora Alvarado, B47769}

%fecha de presentación (* si se deja en blanco indicará la fecha de la compilación)
%\date{Mes de año}

%---------------hasta aquí datos de la portada-------------------------
%
%--------------------------------------------------------------------------------
%portada
\eietitlepage
\newpage
%--------------------------------------------------------------------------------
%
%---------------------------------------------------------------------------------
%------------- A partir de aquí se escribe el informe ----------------------------
%---------------------------------------------------------------------------------
%las siguientes son las secciones iniciales del informe

%Esto hay que revisarlo!

\section{Resumen}
Los robots móviles son muy importantes porque permiten sistemas más flexibles, abriendo toda un área
de la robótica que involucra el problema de la localización%referencias.

En el presente documento se analiza el caso específico de un robot diferencial, el cual es un sistema que
se moviliza en el plano xy debido a la acción de dos ruedas que funcionan de manera
independiente. Se lleva a cabo la obtención de un modelo cinemático directo, un modelo cinemático
inverso, y un modelo dinámico que describe las consideraciones energéticas del sistema. Se
realizaron las simulaciones correspondientes para cada modelo, y postgeriormente analizar la respuesta
 del movimiento del sistema a las entradas respectivas. 


%-------------------
%tablas de contenido (* si alguna no se ocupa se puede ``comentar'' (%) para que no aparezca)
\newpage
\tableofcontents
\newpage
\listoffigures
\newpage
\listoftables
\newpage

%-------------------------------------------------------------------
%lista de la nomenclatura utilizada en el texto

\section*{Nomenclatura}

\begin{description}[labelindent=1cm,labelwidth=2.25cm,align=left]
%ponerlo en orden alfabetico
        \item[$L$] Lagrangiano de un sistema [$J$]
        \item[$K$] Energía cinética de un sistema [$J$]
        \item[$U$] Energía potencial de un sistema [$J$]
        \item[$q_j$] Coordenada generalizada
        \item[$Q_j$] Fuerza generalizada
        \item[$n$] Cantidad de grados de libertad de un sistema
        \item[$J$] Momento de inercia de un cuerpo [$Nms^2$]
        \item[$m$] Masa de un cuerpo [$kg$]
        \item[$\vec{v}$] Velocidad del centro de masa de un cuerpo [$m/s$]
        \item[$\omega$] Velocidad angular [$rad/s$]
        \item[$k$] Constante de un resorte traslacional [$N/m$]
        \item[$d_E$] Elongación de un resorte traslacional [$m$]
        \item[$h$] Altura del centro de masa de un cuerpo [$m$]
        \item[$g$] Constante de la gravedad terrestre [$m/s^2$]
        \item[$p_0$] Posición del centro geométrico (punto entre las ruedas) [$m$]
        \item[$p_d$] Posición del punto descentralizado [$m$]
        \item[$p_g$] Posición del centro de masa [$m$]
        \item[$d$] Distancia entre el centro del robot y el punto descentralizado [$m$]
        \item[$B$] Factor de amortiguamiento viscoso torsional [$Ns$]
        \item[$2b$]  Ancho del robot [$m$]
        \item[$s$] Distancia entre el centro de masa y el geométrico en el robot [$m$]
        \item[$p_r$] Posición de la rueda derecha [$m$]
        \item[$p_l$] Posición de la rueda izquierda [$m$]
        \item[$\varphi_r$] Posición angular de la rueda derecha [$rad$]
        \item[$\varphi_l$] Posición angular de la rueda izquierda [$rad$]
        \item[$K$]  Energía cinética [$J$]
        \item[$r$] Radio de una rueda [$m$]
        \item[$m_c$] Masa del cuerpo del robot [$kg$]
        \item[$m_w$] Masa de una rueda [$kg$]
        \item[$I_g$] Momento de inercia del cuerpo alrededor del centro de masa [$Nms^2$]
        \item[$I_w$] Momento de inercia de una rueda alrededor de su eje central [$Nms^2$]
        \item[$I_m$] Momento de inercia de una rueda alrededor de un diámetro [$Nms^2$]
        \item[$\omega$] Rapidez angular de la rotación del robot [$rad/s$]
        \item[$\theta$] Orientación del robot [$rad$]
        \item[$x$] Posición del centro geométrico en el eje X [$m$]
        \item[$y$] Posición del centro geométrico en el eje Y [$m$]
       
\end{description}

%--------------------
\newpage
\pagenumbering{arabic}
\pagestyle{fancy}
\setlength\headheight{14.5pt}
\lhead{\nouppercase{\leftmark}}
\rhead{\thepage}
\fancyfoot{}

% ------------------------------------------------------------------ Secciones del informe (puede
% ser un solo archivo o separarse los secciones en archivos independientes e incluirse
% con \include('nombre_archivo') si se quiere una nueva página antes de la parte que se está
% anexando o \input{'nombre de archivo'} si se quiere agregar directamente en la posición donde se
% llama a \input{}


%------------------
\section{Introducción}
El desarrollo de robots móviles, responde a la necesidad de extender el campo de aplicación de la
Robótica en la actualidad. En este campo, se trata de incrementar la autonomía del robot, limitando
en todo lo posible la necesidad de intervención humana \citep{Collazo}.

Los robots de dos ruedas, tienen la ventaja de que son altamente maniobrables, al poder girar sobre
su eje z como lo muestra la figura \ref{ejes}. También, pueden construirse altos sin requerir de una base muy grande, lo que los
hace muy útiles en interiores, en donde pueden pasar por lugares estrechos y dar curvas muy cerradas
\citep{KarlStol}.  Algunas de sus aplicaciones, pueden ser como guías de excursiones dentro de
museos, bases de equipo médico dentro de hospitales, para vigilancia (segway) y de limpieza en el
hogar \citep{Coelho}.

\subsection{Objetivos}

Se establecieron los siguientes objetivos para el desarrollo del trabajo:

\begin{itemize}
	\item Estudiar la dinámica de un robot de dos ruedas.
	
	\item Analizar el sistema y obtener un modelo matemático que lo describa
	
	\item Simular el sistema.

\end{itemize}


\section{Marco teórico}

%\subsection{Descripción general de los robots de dos ruedas}


%El sistema que se estudia son los robots de dos ruedas coaxiales, encontrándose normalmente una a
%cada lado del cuerpo, con el centro de masa sobre el eje de las ruedas. Debido a que el centro de
%masa se encuentra sobre el eje de las ruedas, estos robots también son conocidos como péndulos
%invertidos móviles \citep{Yan-Hou}, ya que su base no está fija en el espacio, sino que puede
%desplazarse sobre una superficie debido a la acción de las ruedas (ver figura
%\ref{fig:segway_robot}).

%Estos robots tienen 3 grados de libertad, los cuales son: traslación hacia adelante o atrás, giro
%sobre su propio eje (yaw), y giro sobre el eje de las ruedas (pitch) (ver figura
%\ref{fig:axis}). Sin embargo, el robot únicamente tiene dos actuadores (las dos ruedas). Por lo
%tanto, se considera un sistema subactuado \citep{Xu}. De esta manera, no se puede lograr el control
%del movimiento del robot en los tres grados de libertad de forma independiente, ya que si se
%controla uno de ellos, los otros también se ven afectados. 


%\begin{figure}
%	\centering
%	\includegraphics[width=0.6\textwidth]{../pictures/robot-segway.png}	
%	\caption{Ejemplo de robot de dos ruedas}
%	\label{fig:segway_robot}
%\end{figure}

%Se debe notar que para que el sistema sea estable, se necesitan al menos tres puntos de apoyo
%\citep{KarlStol}. La mayor propiedad de este sistema, es que se considera dinámicamente estable
%\citep{Yan-Hou} o estáticamente inestable \citep{KarlStol}, esto porque se debe tener un controlador
%activo para mantener al sistema cerca de un punto de operación, y así evitar que se caiga.

%Figura 2 de modelling and control of two wheeled robots

%\begin{figure}
%	\centering
%	\includegraphics[width=0.4\textwidth]{../pictures/Axis.pdf}	
%	\caption{Grados de libertad de un robot de dos ruedas}
%	\label{fig:axis}
%\end{figure}

%\subsection{Consideraciones Iniciales}
%El objetivo de estos sistemas es evitar que se caigan, entonces es conveniente tomar la salida como
%el ángulo respecto a la normal con el suelo, es decir el ángulo pitch, denotado como $\phi$. Por
%otra parte, la entrada son los torques que actúan sobre el cuerpo. El torque que provoca la gravedad
%puede no ser considerado como una entrada, pero el torque de las ruedas y el torque de
%perturbaciones externas (como empujar al robot), sí corresponden a entradas.


\subsection{Robots de locomoción diferencial}

Los robots de ruedas diferenciales, son aquellos donde su locomoción está basada en dos (o más) ruedas motrices fijas controladas independientemente, dichas ruedas son las que proporcionan fuerza de tracción al robot. La relación entre ellas es la que determina la trayectoria que va a seguir el robot \citep{Saifizi} . Estos robots son no holónomos por lo tanto son sistemas con restricciones en las velocidades no integrables, es decir no es posible expresarlas, exclusivamente, en término de las posiciones \citep{Freire}.
\\

Algunas de las ventajas de estos sistemas de dos ruedas es que son más baratos, son fáciles de implementar y tienen un diseño simple, por otro lado son un poco más dificiles de controlar ya que son estáticamente inestables y requiere un control de precisión para trayectorias rectas \citep{sis_locomocion} \\.

El modelo de robot que se estudia en el presente trabajo se supone con dos motores independientes, cada uno controlando una rueda, colocados a lo ancho  del eje central del robot. Se asume además su movimiento únicamente en dos dimensiones, por lo que se considera con una tercera rueda que no aporta ningún movimiento adicional (rueda loca o de castor) para que sea estable \citep{KarlStol}, además se considera que no hay deformación en la rueda y que se cumple la condición de rodamiento puro.

%\begin{figure}
%	\centering
%	\includegraphics[width=0.6\textwidth]{../pictures/robot_ejes.eps}	
%	\caption{Ejes del Robot}
%	\label{fig:ejes}
%\end{figure}


%\subsection{Método de linealización}
%Los sistemas en estudio son intrínsicamente no lineales \citep{Sayidmarie}. De esta manera, para
%facilitar el análisis se puede considerar el sistema alrededor de un punto de operación específico,
%en donde el mismo puede considerarse como lineal. En el caso específico del sistema a analizar,
%si se denomina $\phi$ cómo el ángulo de pitch, ya que el interés es mantener al robot en posición
%vertical, se puede tomar como punto de operación la condición de $\phi=0$.

%En general, se tiene que el modelo en variables de estado de un sistema no lineal viene dado por la
%ecuación \ref{eq:estados_no_lineal}:

%\begin{equation}
%\frac{d\mathbf{x}(t)}{dt}=f(\mathbf{x}(t),\mathbf{u}(t))
%\label{eq:estados_no_lineal}
%\end{equation}

%Ahora, por el teorema del valor medio, se sabe que existe $t_0<\delta<t$ tal que (ecuación
%\ref{eq:mean_theorem}):

%\begin{equation}
%J_f(\mathbf{x},\mathbf{u})(\mathbf{x}(t_0+\delta)+\mathbf{u}(t_0+\delta))=\frac{f(\mathbf{x}(t),\mathbf{u}(t))-f(\mathbf{x}(t_0),\mathbf{u}(t_0))}{t-t_0}
%\label{eq:mean_theorem}
%\end{equation}
 
%En donde $J_f$ es el jacobiano de $f$. Para el caso particular del punto de operación, se tiene que
%$t_0=0$. Como se supone que $t$ es muy cercano a $0$, entonces se aproxima que $\delta=0$. Por otro
%lado, $J_{f_x}$ y $J_{f_u}$ son las porciones del jacobiano de $f$ que dependen únicamente de
%$\mathbf{x}$ y $\mathbf{u}$, respectivamente.

%Se define $\mathbf{x'}(t)=\mathbf{x}(t)-\mathbf{x}(0)$ y
%$\mathbf{u'}(t)=\mathbf{u}(t)-\mathbf{u}(0)$. Despejando $f$ de la ecuación \ref{eq:mean_theorem}, y
%sustituyendo \ref{eq:estados_no_lineal}, se obtiene la ecuación \ref{eq:meantheo}:

%\begin{equation}
%\frac{dx'(t)}{dt}=J_{f_x}|_0\mathbf{x'}(t)+J_{f_u}|_0\mathbf{u'}(t)
%\label{eq:meantheo}
%\end{equation}

%De esta manera, se obtiene un modelo en variables de estado lineal cuando el ángulo de pitch es
%cercano a cero \citep{Buck}.

\subsection{Análisis de sistemas mecánicos: Enfoque de energías}
Para modelar sistemas mecánicos como el que se estudiará en el presente trabajo, resulta conveniente
utilizar el enfoque de energías, el cual facilita obtener las ecuaciones del movimiento de sistemas
mecánicos con múltiples grados de libertad y que utilicen coordenadas generalizadas (no restringidas
a ser cartesianas).

Las coordenadas generalizadas de un sistema mecánico, se definen como la mínima cantidad de
parámetros que pueden definir de manera completa la configuración del sistema, siendo variables
independientes entre sí \citep{fitzpatrick2011}. Por otro lado, los grados de libertad son la
cantidad de coordenadas que pueden ser modificadas de manera independiente para determinar la
configuración de los cuerpos en el sistema \citep{vandiver2011}.

El Lagrangiano, definido como $L=K-U$, es función de las coordenadas generalizadas y de sus
respectivas derivadas \citep{gavin2014}, tal como se muestra en la ecuación \ref{eq:lagrangian}, en
donde $n$ es la cantidad de grados de libertad del sistema.

\begin{equation}
  L=L(q_{1},...q_{j}...q_{n}, \dot{q_{1}},...\dot{q_{j}}...\dot{q_{n}})
  \label{eq:lagrangian}
\end{equation}

La ecuación \ref{eq:euler-lagrange} se conoce como la ecuación de Euler-Lagrange, y permite obtener
una ecuación de movimiento para cada coordenada generalizada ($q_j$) \citep{vandiver2011}, lo que
genera un sistema de $n$ ecuaciones diferenciales de las cuales se puede construir el modelo en
variables de estado.

\begin{equation}
  \frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q_j}}\right)-\frac{\partial
    L}{\partial q_j} = Q_j
\label{eq:euler-lagrange}
\end{equation}

El término $Q_j$ de la ecuación \ref{eq:euler-lagrange}, denominado fuerza generalizada
\citep{gavin2014}, consiste en el componente de la fuerza neta no conservativa del sistema que
realiza trabajo en la dirección de $q_j$, lo cual involucra las fuerzas externas y las disipativas.

Para poder utilizar las ecuaciones de Euler-Lagrange, es necesario que el sistema sea holonómico
\citep{vandiver2011}, lo que significa que la cantidad de coordenadas generalizadas a utilizar es
igual a la cantidad de grados de libertad del sistema.

La energía potencial y cinética que componen el Lagrangiano del sistema, dependen de factores como
el tipo de movimiento, la posición de los cuerpos y la constitución física de los mismos
(elasticidad). En el cuadro \ref{tab:energias}, se muestran algunos de los principales tipos de
dichas energías para sistemas mecánicos.

\begin{table}[H]
\centering
\caption{Principales tipos de energías cinéticas y potenciales para un sistema mecánico}
\label{tab:energias}
\begin{tabular}{@{}ll@{}}
\toprule
\multicolumn{2}{l}{\textbf{Energía cinética (K)}} \\ \midrule
Traslacional & $\frac{1}{2} m {\left\lVert \vec{v} \right\rVert}^2  $   \\ \midrule
Rotacional & $\frac{1}{2} J {\omega}^2$ \\ \midrule
\multicolumn{2}{l}{\textbf{Energía potencial (U)}} \\ \midrule
Gravitacional & $mgh$ \\ \midrule
Elástica (Resorte) & $\frac{1}{2}k{d_E}^2$ \\ \bottomrule
\end{tabular}
\end{table}


El modelado de la tracción delantera de un robot móvil es una condición no holonómica  que esta sujeto a una serie de restricciones p no integrables que involucran las derivadas con respecto al tiempo del vector de configuración q y estas toman la forma de la ecuación \ref{eq:mul_lagrange}.

\begin{equation}
\label{eq:mul_lagrange}
\frac{d}{dt}\left(\frac{\partial k}{\partial \dot{q_1}}\right) - \left(\frac{\partial k}{\partial q_1}\right)= \left(\frac{\partial U}{\partial q_1}\right) + \sum  \frac{\lambda \partial f_i}{\partial \dot{q_1}}
\end{equation}


\subsection{Sistemas subactuados}
Un sistema subactuado es aquel en el cual existen menos actuadores que grados de libertad \citep{Conejo}, es decir una sola entrada controla movimientos distintos e independientes del robot . Una ventaja de estos sistemas es que al utilizar menos actuadores consumen menos energía sin embargo el control se vuelve un poco más complejo. 



\section{Modelado y simulación}

Se procede a obtener el modelo cinemático (directo e inverso) y  el modelo dinámico de un robot de
dos ruedas, para lo cual se toman las siguientes consideraciones generales:
\begin{itemize}
\item El robot no se desliza hacia los lados, de modo que solo se puede desplazar en la dirección
  definida por el frente del mismo.
\item La rapidez traslacional del robot sobre el punto en donde se ubica cada rueda, es igual a la
  rapidez tangencial de la rueda respectiva en contacto con el suelo, lo cual corresponde a la
  condición de rodadura.
\item El robot sólamente puede perder energía debido a la fricción en los ejes de cada rueda, la
  cual se considera viscosa para simplificar la obtención del modelo.
\item No existen fuerzas externas aplicadas al robot excepto por la fuerza asociada al torque de los
  motores, ni tampoco se presentan colisiones con otros posibles cuerpos externos al sistema. De
  esta forma, el movimiento del robot está completamente determinado por su dinámica y por la fuerza
  aplicada por los motores.
\item El movimiento que describe el robot se lleva a cabo sobre una superficie plana, de manera que
  no hay cambios energéticos debidos a la acción del campo gravitacional terrestre sobre el robot.
\item El cuerpo del vehículo es no deformable, de modo que no se acumula energía potencial debido a
  elasticidad ni se dan pérdidas de energía debido a la deformación de las llantas o el cuerpo del
  robot.
\item No se consideran las limitaciones relacionadas con la potencia máxima que pueden entregar los motores
  de cada rueda, de manera que los mismos pueden generar pares de torsión muy grandes que cambian de
  manera abrupta.
 \item La distribución de masa del robot es uniforme. %simétrica con respecto a la línea central definida por el
  % frente del vehículo, de manera que tanto el centro de masa como el centro geométrico se encuentran
  % sobre dicha línea.  
\item El cuerpo del robot no se comporta como un péndulo invertido, ya que presenta el soporte
  adecuado para mantenerse estable sin balancearse.
\end{itemize}


\subsection{Modelo cinemático}
\subsubsection{Modelo directo}


Para efectos de la obtención de este modelo se considera el centro del robot como el punto medio en el eje de las ruedas (también se le llama centro geométrico). La posición de este punto de describe por el vector $\mathbf{p_0}$. Se toma que cuando el robot está orientado hacia el eje x positivo, entonces su ángulo de orientación es $0^\circ$. Luego se define el ángulo de orientación $\theta$ como el medido a partir del eje x positivo. Como se muestra en la figura %ref

La posición de cada motor se decribe por los vectores $\mathbf{p_l}$ y $\mathbf{p_r}$ para el motor izquierdo y derecho respectivamente. Note que, utilizando álgebra de vectores, se puede deducir que: 

\begin{equation}
\begin{cases}
\mathbf{p_r}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c}b\cos(\frac{\pi}{2}-\theta(t))&  -b\sen(\frac{\pi}{2}-\theta(t))\end{array}\right]^t\\
\mathbf{p_l}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c}-b\cos(\frac{\pi}{2}-\theta(t))&  b\sen(\frac{\pi}{2}-\theta(t))\end{array}\right]^t
\end{cases}
\label{eq:global_position_prev_simplification}
\end{equation}


Note que $\cos(\frac{\pi}{2}-\theta(t))=\sen(\theta(t))$ y que $\sen(\frac{\pi}{2}-\theta(t))=\cos(\theta(t))$. Entonces, sustituyendo en (\ref{eq:global_position_prev_simplification}), se obtiene (\ref{eq:global_position}). 

\begin{equation}
\begin{cases}
\mathbf{p_r}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c} b\sen(\theta(t))&  -b\cos(\theta(t))\end{array} \right]^t\\
\mathbf{p_l}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c} -b\sen(\theta(t))&  b\cos(\theta(t))\end{array}\right]^t
\end{cases}
\label{eq:global_position}
\end{equation}

Se define que $\mathbf{p_0}(t)=\left[ \begin{array}{c c} x(t) & y(t) \end{array} \right]^t$, entonces tome $\dot{\mathbf{p_0}}(t)=\mathbf{v_0}(t)=\left[ \begin{array}{c c} \dot{x}(t) & \dot{y}(t) \end{array} \right]^t$ y $\dot{\theta}(t)=\omega(t)$. 

Derivando (\ref{eq:global_position})se obtiene:

\begin{equation}
\begin{cases}
\dot{\mathbf{p_r}}(t)=\mathbf{v_r}(t)=\mathbf{v_0}(t)+\left[  \begin{array}{c c} b\cos(\theta(t)) \omega(t) &  b\sen(\theta(t)) \omega(t) \end{array}\right]^t \\
\dot{\mathbf{p_l}}(t)=\mathbf{v_l}(t)=\mathbf{v_0}(t)+\left[  \begin{array}{c c}-b\cos(\theta(t)) \omega(t) & -b\sen(\theta(t)) \omega(t) \end{array}\right]^t
\end{cases}
\label{eq:global_velocities}
\end{equation}

Reescribiendo (\ref{eq:global_velocities}), pero sustituyendo que $\mathbf{v_n}=\left[ \begin{array}{c c} v_n\cos(\theta(t)) & v_n\sen(\theta(t)) \end{array} \right]^t$  en  (\ref{eq:velocities_system}) donde $|\mathbf{v_n}|=v_n$.

\begin{equation}
\begin{cases}
\begin{array}{c c c c c}
v_r\cos(\theta(t)) &=&v_0\cos(\theta(t))&+&b\cos(\theta(t))\omega(t)\\
v_r\sen(\theta(t)) &=&v_0\sen(\theta(t))&+&b\sen(\theta(t))\omega(t)\\
v_l\cos(\theta(t)) &=&v_0\cos(\theta(t))&+&b\cos(\theta(t))\omega(t)\\
v_l\sen(\theta(t)) &=&v_0\sen(\theta(t))&+&b\sen(\theta(t))\omega(t)
\end{array}
\end{cases}
\label{eq:velocities_system}
\end{equation}

De (\ref{eq:velocities_system}) suponga que $\cos(\theta(t))\neq 0$, entonces se concluye (\ref{eq:local_vel_wheels}) multiplicando por $1/\cos(\theta(t))$ a ambos lados de las ecuaciones. Si $\cos(\theta(t))= 0$, se sabe que $\sen(\theta(t))\neq 0$, y por tanto también se puede concluir (\ref{eq:local_vel_wheels}).

\begin{equation}
\begin{cases}
v_r(t)=v_0(t)+b\omega(t)\\
v_l(t)=v_0(t)-b\omega(t)
\end{cases}
\label{eq:local_vel_wheels}
\end{equation}

Note que como lo que se puede controlar es $\dot{\varphi}_r$ y $\dot{\varphi}_l$, las velociddes angulares de los motores derecho e izquierdo respectivamente. Entonces se despeja $v_0$ y $\omega(t)$ en términos de $v_r$ y $v_l$ y si se toma en consideración que el radio de las ruedas es $r$, se obtiene el resultado en (\ref{eq:local_vel}) y en (\ref{eq:local_dir}). En adelante considere $b_2=2b$ para simplificar la notación.

\begin{equation}
v_0(t) =\frac{r}{2}(\dot{\varphi}_r(t)+\dot{\varphi}_l(t))
\label{eq:local_vel}
\end{equation} 

\begin{equation}
\dot{\theta}(t)=\frac{r}{b_2}(\dot{\varphi}_r(t)-\dot{\varphi}_l(t))
\label{eq:local_dir}
\end{equation}

También es sabido que:
\begin{equation}
\mathbf{v_0}(t)=\left[ \begin{array}{c} \dot{x}(t) \\ \dot{y}(t) \end{array} \right]=\left[\begin{array}{c} v_0(t)\cos(\theta(t)) \\ v_0(t)\sen(\theta(t)) \end{array} \right]
\label{eq:global_vel}
\end{equation} 

Entonces, sustituyendo (\ref{eq:local_vel}) en (\ref{eq:global_vel}), y tomando en consideración (\ref{eq:local_dir}), se obtiene la ecuación descrita en (\ref{eq:kinematic_model_matrix}).

\begin{equation}
\left[
\begin{array}{c}
\dot{x}(t)\\\dot{y}(t)\\\omega(t)
\end{array}
\right]
=
\left[
\begin{array}{c c}
\frac{r}{2}\cos(\theta(t))&\frac{r}{2}\cos(\theta(t))\\
\frac{r}{2}\sen(\theta(t))&\frac{r}{2}\sen(\theta(t))\\
\frac{r}{b_2}&\frac{-r}{b_2}
\end{array}
\right]
\left[
\begin{array}{c}
\dot{\varphi}_r(t)\\ \dot{\varphi}_l(t)
\end{array}
\right]
\label{eq:kinematic_model_matrix}
\end{equation}

Se definen los siguientes vectores, para simplificar la notación de esta sección: $\nu(t)=\left[\begin{array}{c c c}\dot{x}(t)&\dot{y}(t)&\omega(t)\end{array}\right]^t$ y $\dot{\varphi}(t)=\left[\begin{array}{c c} \dot{\varphi}_r(t)& \dot{\varphi}_l(t) \end{array} \right]^t$. Se define $\Lambda(t)$, como la matriz en (\ref{eq:kinematic_model_matrix}). De esta menra de reescribe la ecuación como:

\begin{equation}
\mathbf{\nu}(t)=\Lambda(t) \mathbf{\dot{\varphi}}(t)
\label{eq:kinematic_model}
\end{equation}

La ecuación (\ref{eq:kinematic_model}) representa el modelo cinemático directo del sistema. Ya que relaciona la entrada ($\mathbf{\dot{\varphi}}(t)$), con la salida ($\mathbf{\nu}(t)$). Resultado concordante con  uno de los presentados en \citep{Ortigoza}.

Podemos resumir el sistema en un modelo de caja negra como el de la figura (\ref{})

\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/backup/caja_cinematico_directo.pdf}	
	\caption{Caja negra modelo cinemático directo}
	\label{fig:caja_cinematico_directo}
\end{figure}



%\subsubsection{Modelo inverso}

%Para encontrar la cinemática inversa, es necesario encontrar las velocidades de las ruedas en términos de la velocidad del robot. Esto se logra computando la pseudoinversa de $\Lambda(t)$, que se denota por $\Lambda^{-1}(t)$. Se utiliza \textit{Wolfram Mathematica} para encontrar una expresión simbólica para $\Lambda^{-1}(t)$. El resultado se muestra en (\ref{eq:pseudoinverse}).

%\begin{equation}
%\Lambda^{-1}=\left[
%\begin{array}{c c c}
%\frac{\cos(\theta(t))}{r} & \frac{\cos(\theta(t))}{r} & \frac{b}{2r}\\
%\frac{\sen(\theta(t))}{r} & \frac{\sen(\theta(t))}{r} & \frac{-b}{2r}\\
%\end{array}
% \right]
%\label{eq:pseudoinverse}
%\end{equation}

%El modelo cinemático inverso viene dado por (\ref{eq:inverse_kinematic_model}):

%\begin{equation}
%\mathbf{\dot{\varphi}}(t)=\Lambda^{-1}\mathbf{\nu}(t)
%\label{eq:inverse_kinematic_model}
%\end{equation}

%La ecuación en (\ref{eq:inverse_kinematic_model}) muestra al vector de velocidades angulares en las ruedas en términos de la velocidad traslacional del centro geométrico del robot y la velocidad angular del robot. Sin embargo por la no holonomicidad %OJO hay que citar esto. No se puede simplemente decir qeu es no holonomico!·········
%del sistema, hay soluciones que no son posibles. Tome el caso en el que se requiera una velocidad traslacionar que sea perpendicular a la orientación actual del robot. Entonces se tiene $\theta(t)$ como la orientación actual. $(\cos(\theta(t)), \sen(\theta(t)))$, es un vector unitario en la dirección del robot. Entonces $\mathbf{v_{per}}(t)=(-\sen(\theta(t)),\cos(\theta(t)))$ es un vector perpendicular a la orientación del robot. Tome $\mathbf{\nu}_{\perp}(t)=\left[\begin{array}{c c c} -\sen(\theta(t))& \cos(\theta(t)) & 0\end{array} \right]^t$. Sutituyendo $\mathbf{\nu}_{\perp}(t)$ en (\label{eq:inverse_kinematic_model}), se obtiene una velocidad angular en las ruedas de $\mathbf{\dot{\varphi}}_{\perp}(t)=$.

%OJO hay que terminar esta parte IMPORTANTE. para justificvar utilizar el punto desplazado. 

\subsubsection{Modelo del punto descentralizado}

%Hacer la justificaciond e contrabilidad.

En algunos casos es más conveniente tomar un punto desplazado del centro del robot. Este normalmente se toma hacia el frente. Se calculan las velocidades de las ruedas para controlar la velocidad traslacional del punto desplazado (conocido en adelante como punto descentralizado). En este caso no se toma en cuenta la orientación, ya que este modelo se utiliza para un robot que usualmente se va a utilizar para seguir trayectorias. De esta manera se hace que el punto desplazado siga la trayectoria, y el centro del robot de manera natural va a seguir la trayectoria con la orientación adecuada. %citar esto que acabod e decir

Entonces considere el punto descentralizado, cuyo vector de posición es $\mathbf{p_d}(t)$. Se define que la distancia entre $\mathbf{p_d}(t)$ y $\mathbf{p_0}(t)$ es $d$. Note que $\mathbf{p_d}(t)$ está fijo en el marco de referencia del robot, entonces $d$ es constante. Se cumple lo descrito en (\ref{eq:punto_desplazado}).

\begin{equation}
\mathbf{p_d}(t)=\mathbf{p_0}(t)+\left[\begin{array}{c c} d\cos(\theta(t))&  d\sen(\theta(t))\end{array} \right]^t
\label{eq:punto_desplazado}
\end{equation}

Luego, derivando (\ref{eq:punto_desplazado}), se obtiene la expresión en (\ref{eq:vel_desplazado}).

\begin{equation}
\dot{\mathbf{p_d}}(t)=\dot{\mathbf{p_0}}(t)+\left[\begin{array}{c c} -d\sen(\theta(t))\omega(t)&  d\cos(\theta(t))\omega(t)\end{array} \right]^t
\label{eq:vel_desplazado}
\end{equation} 

Para expresar la velocidad en el punto descentralizado descrita en (\ref{eq:vel_desplazado}), se define $\Psi(t)$ en (\ref{eq:matriz_m}), la matriz de trasformación del punto central al punto descentralizado.

\begin{equation}
\dot{\mathbf{p_d}}(t)=\left[ \begin{array}{c c c} 1&  0& -d\sen(\theta(t))\\
                                                 0&  1&  d\cos(\theta(t))\end{array}  \right] \mathbf{\nu}(t)
=\Psi(t) \mathbf{\nu}(t)
\label{eq:matriz_m}
\end{equation} 


Ahora, se define $A(t)=\Psi(t)\Lambda(t)$, para obtener la relación entre $\dot{\mathbf{p_d}}(t)$, y $\mathbf{\dot{\varphi}}(t)$. Como se presenta en (\ref{eq:modelo_desplazado}).

\begin{equation}
\dot{\mathbf{p_d}}(t)= \left[ \begin{array}{c c} 0.5r\cos(\theta(t))-\frac{dr\sen(\theta(t))}{b_2}& 0.5\cos(\theta(t))+\frac{er\sen(\theta(t))}{b_2}  \\
                                                 -0.5r\sen(\theta(t))-\frac{dr\cos(\theta(t))}{b_2}& 0.5\sen(\theta(t))-\frac{dr\cos(\theta(t))}{b_2}  \end{array}  \right] \mathbf{\dot{\varphi}}(t)=A(t)\mathbf{\dot{\varphi}}(t)
\label{eq:modelo_desplazado}
\end{equation}

Se define a $\theta$ como el estado del sistema. Entonces la relación entrada-estado del modelo directo del punto descentralizado viene dada en (\ref{eq:local_dir}). Y la relación entrada-salida-estado viene dada en (\ref{eq:modelo_desplazado}). 

Para esta sección se puede resumir de la siguiente forma en entradas y salidas según la figura (\ref{caja_cinematico_inverso})

\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/backup/caja_cinematico_descentralizado.pdf}	
	\caption{Caja negra del modelo cinemático con punto descentralizado}
	\label{caja_cinematico_inverso}
\end{figure}


\subsubsection{Modelo inverso del punto descentralizado}

Para poder controlar al robot, se necesita el modelo inverso. Primero se debe determinar si es posible encontrarlo. Se tiene que $det(A)=-\frac{dr^2}{b_2}$, de manera que el determinante es no nulo para todo valor de $t$. Entonces siempre es posible encontrar la matriz inversa de $A(t)$, esta se denota por $A^{-1}(t)$, su resultado se muestra en (\ref{eq:a_inverso}). Para el modelo inverso, se tiene a $\mathbf{\dot{\varphi}}(t)$ como la salida, y a $\dot{\mathbf{p_d}}(t)$ como la entrada, pero el estado no cambia; $\theta(t)$ es el estado de este modelo. Entonces en (\ref{eq:desplazado_inverso}) se muestra la relación entre la entrada y la salida del modelo inverso. De sustituir (\ref{eq:local_dir}) en  (\ref{eq:desplazado_inverso}), se obtiene (\ref{eq:estado_entrada_desplazado}). Finalmente, el modelo cinemático inverso para el punto desplazado viene dado por las ecuaciones (\ref{eq:a_inverso}),(\ref{eq:estado_entrada_desplazado}) y (\ref{eq:desplazado_inverso}).

\begin{equation}
A^{-1}(t)=
\left[
\begin{array}{cc}
 \frac{ d \cos (\theta (t))-0.5 b_2 \sen (\theta (t))}{d r} & \frac{0.5 b_2 \cos
   (\theta (t))+ d \sen (\theta (t))}{d r} \\
 \frac{ d \cos (\theta (t))+0.5 b_2 \sen (\theta (t))}{d r} & \frac{ d \sen
   (\theta (t))-0.5 b_2 \cos (\theta (t))}{d r} \\
\end{array}
\right]
\label{eq:a_inverso}
\end{equation}

\begin{equation}
\mathbf{\dot{\varphi}}(t)=A^{-1}(t)\dot{\mathbf{p_d}}(t)
\label{eq:desplazado_inverso}
\end{equation}

\begin{equation}
\dot{\theta}(t)=\left[
\begin{array}{cc}
 \frac{b_2}{r} & \frac{-b_2}{r}
\end{array}
\right] A^{-1} \dot{\mathbf{p_d}}(t)
\label{eq:estado_entrada_desplazado}
\end{equation}

Este Modelo tambi\'en se obtiene en \citep{Marin}.

%Esta parte puede que desaparezca! ya no es tan relevante!****************************************************
%*************************************************************************************************************


%IMPORTANTE definir centro geometrico. Puede que sea distinto al punto medio entre las llantas!
Para analizar el comportamiento del centro geométrico del robot, y el punto desplazado, se debe encontrar una transformación que los relacione. De esta manera se puede verificar qeu al controlar el punto desplazado, se logra un control indirecto sobre el centro geométrico, y que la orientación del robot se adapta, conforme el robot avanza en la trayectoria. Sustituyendo (\ref{eq:kinematic_model}) en (\ref{eq:desplazado_inverso}) se obtiene (\ref{eq:desplazado_contra_centro}), que es la relación entre la velocidad en el punto desplazado (que se puede controlar) y el centro geométrico (sobre el que no se tiene control completo).

 \begin{equation}
\mathbf{\nu}(t)=\Lambda A^{-1}\dot{\mathbf{p_d}}(t)=
\left[
\begin{array}{cc}
 \cos^2(\theta(t)) & \cos(\theta(t))\sen(\theta(t))\\
 \cos(\theta(t))\sen(\theta(t))& \sen^2(\theta(t))\\
\frac{-\sen(\theta(t))}{d}&\frac{\cos(\theta(t))}{d}
\end{array}
\right] \dot{\mathbf{p_d}}(t)
\label{eq:desplazado_contra_centro}
\end{equation}

\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/backup/caja_cinematico_inverso.pdf}	
	\caption{Caja negra del modelo cinemático inverso del punto descentralizado }
	\label{fig:evaluacion_de_la_restriccion_cuadrado}
\end{figure}
%Esta parte puede que desaparezca! ya no es tan relevante!****************************************************
%*************************************************************************************************************

\subsection{Modelo dinámico}
La obtención del modelo dinámico se fundamenta en la aplicación del método de Euler-Lagrange
considerando las restricciones propias del sistema del robot diferencial de dos ruedas. Este
modelado es consecuente con los resultados obtenidos por \cite{zohar} y \cite{sarkar}, lo cual
demuestra su validez.

A partir de la condición de no deslizamiento hacia los lados, se obtiene que el componente de la
velocidad traslacional del centro geométrico que es perpendicular a la recta descrita por el frente del
robot (definida por el ángulo de orientación $\theta(t)$), es nulo, lo cual se muestra en (\ref{eq:restriccion_1}).

\begin{equation}
\label{eq:restriccion_1}
f_1  =  \dot{x}(t)sen(\theta(t)) -\dot{y}(t)cos(\theta(t)) = 0 
\end{equation}


Para la rueda derecha, se tiene que la magnitud de su velocidad tangencial es la mostrada en
(\ref{eq:vel_tan_rueda_r}).
\begin{equation}
  \label{eq:vel_tan_rueda_r}
  v_{Tr}(t) = r\dot{\varphi_r}(t)
\end{equation}

En donde $r$ es el radio de cada rueda y $\dot{\varphi_r}(t)$ es la velocidad angular de un punto de
la rueda derecha.

Por otro lado, la magnitud de la velocidad traslacional del punto en donde se encuentra ubicada la
rueda derecha sobre el vehículo corresponde a la expresión de (\ref{eq:vel_tras_rueda_r}).

\begin{equation}
  \label{eq:vel_tras_rueda_r}
  v_{Pr}(t)=\dot{x}(t)\cos(\theta(t))+\dot{y}(t)\sen(\theta(t))+b\dot{\theta}(t)
\end{equation}
 

En donde el término $\dot{x}(t)\cos(\theta(t))+\dot{y}(t)\sen(\theta(t))$ es la rapidez traslacional
del centro del vehículo, y el término $b\dot{\theta}(t)$ corresponde al aporte en la velocidad dado
por la rotación del robot, el cual se suma porque el giro en la dirección positiva de incremento de
$\theta(t)$ (contraria a las manecillas del reloj) favorece el movimiento hacia adelante de la rueda
derecha. De la restricción de rodamiento de las ruedas, se tiene que $v_{Tr}=v_{Pr}$, lo cual se
muestra en (\ref{eq:restriccion_2}).

\begin{equation}
\label{eq:restriccion_2}
f_2 =  \dot{x}(t)cos(\theta(t)) + \dot{y}(t)sen(\theta(t)) + b \dot{\theta}(t) - r \dot{\varphi_{r}}(t) = 0 \\
\end{equation}

De manera análoga, se tiene que la velocidad tangencial de la rueda izquierda corresponde a
(\ref{eq:vel_tan_rueda_l}), y que la velocidad traslacional del punto en donde se encuentra ubicada
dicha rueda es la mostrada en (\ref{eq:vel_tras_rueda_l}).

\begin{equation}
  \label{eq:vel_tan_rueda_l}
  v_{Tl}(t) = r\dot{\varphi_l}(t) 
\end{equation}

\begin{equation}
  \label{eq:vel_tras_rueda_l}
  v_{Pr}(t)=\dot{x}(t)\cos(\theta(t))+\dot{y}(t)\sen(\theta(t))-b\dot{\theta}(t)
\end{equation}


En donde el aporte en la velocidad dada por la rotación del robot $b\dot{\theta}(t)$, se resta
porque el giro en la dirección positiva de incremento de $\theta(t)$ se opone al movimiento hacia
adelante de la rueda izquierda. De la misma forma que para la rueda derecha, la restricción de
rodamiento implica que se cumple que $v_{Tl}=v_{Pl}$, lo cual se presenta en (\ref{eq:restriccion_3}).

\begin{equation}
\label{eq:restriccion_3}
f_3  =  \dot{x}(t)cos(\theta(t)) + \dot{y}(t)sen(\theta(t)) - b \dot{\theta}(t) - r \dot{\varphi_{l}}(t) = 0 \\
\end{equation}


Con respecto a las restricciones descritas por las ecuaciones (\ref{eq:restriccion_1}),
(\ref{eq:restriccion_2}) y (\ref{eq:restriccion_3}), denominadas $f_1$, $f_2$ y $f_3$
respectivamente, se conoce que las mismas corresponden a restricciones no holonómicas (***Sarkar),
ya que establecen condiciones sobre las derivadas de las coordenadas generalizadas a utilizar para
el método de Euler-Lagrange, las cuales corresponden a $x(t)$, $y(t)$, $\theta(t)$, $\varphi_r(t)$ y
$\varphi_l(t)$.

Estas restricciones no holonómicas, las cuales dependen de multiplicadores de Lagrange tal como se
muestra en la ecuación (\ref{eq:mul_lagrange}), y que en este caso son $\lambda_1$, $\lambda_2$ y
$\lambda_3$, correspondientes a $f_1$, $f_2$ y $f_3$ respectivamente. .

Para el método de Lagrange, se tiene en primer lugar que la energía potencial asociada al sistema es
constante, ya que el centro de masa del robot se mueve en un plano horizontal y no se consideran las
posibles deformaciones elásticas del vehículo, ni tampoco se presenta el comportamiento de péndulo
invertido. De esta forma, el término que está asociado al cambio en la energía potencial en la
ecuación de Lagrange (\ref{eq:mul_lagrange}) para cada coordenada es cero
($\frac{\partial U}{\partial q_i} = 0$), de lo que se obtiene la ecuación
(\ref{eq:lagrange_restrict_final}), la cual se utilizará para la obtención de las ecuaciones del
movimiento del sistema.

\begin{equation}
  \frac{d}{dt}\left( \frac{\partial K}{\partial \dot{q_i}}\right) - \frac{\partial K}{\partial
    q_i} = Q_i + \sum_{k=1}^3 \lambda_k \frac{\partial f_k}{\partial \dot{q_i}}
  \label{eq:lagrange_restrict_final}
\end{equation}

De esta forma, se procede a obtener la energía cinética total del sistema, así como las fuerzas
generalizadas correspondientes a cada coordenada, para luego obtener las ecuaciones del movimiento
correspondientes.

En primer lugar, si se estudia el movimiento del cuerpo del vehículo sin las ruedas (de masa $m_c$),
se puede calcular la energía cinética correspondiente a esta porción del robot. Para el componente
traslacional, se considera que dicho cuerpo sólido es equivalente a una partícula de masa $m_c$ que
se encuentra ubicada en el centro de masa del cuerpo, localizado a una distancia $s$ en línea recta
con el centro geométrico del robot, el cual se toma en medio de las dos ruedas. 

Se tiene entonces que la posición que permite ubicar al centro de masa es la mostrada en
(\ref{eq:posición_carrito}). De dicho punto se puede obtener la velocidad del centro de masa
(\ref{eq:vel_centro_masa}), a partir de la cual se obtiene la energía cinética traslacional, que
corresponde a la expresión de (\ref{eq:k_tras_cuerpo}).

\begin{equation}
\mathbf{p_g}(t) = \left[ \begin{array}{c}
x_g(t) \\ y_g(t) \end{array} \right] = \left[ \begin{array}{c} x(t) + s \cos \left( \theta(t) \right)\\
 y(t) + s \sen\left( \theta(t) \right) \end{array} \right]
\label{eq:posición_carrito}
\end{equation}


\begin{equation}
 \mathbf{\dot{p_g}}(t)= \left[ \begin{array}{c} \dot{x_g}(t) \\ \dot{y_g}(t) \end{array} \right] = \left[
    \begin{array}{c} \dot{x}(t)-s\sen(\theta(t))\dot{\theta}(t) \\ \dot{y}(t)+s\cos(\theta(t))\dot{\theta}(t) \end{array} \right]
  \label{eq:vel_centro_masa}  
\end{equation}

\begin{equation}
  \label{eq:k_tras_cuerpo}
  K_{Ctr} = \frac{1}{2}m_c \left\lVert \mathbf{\dot{p_g}}\right\rVert^2 = \frac{1}{2}m_c \left( \dot{x_g}(t)^2 + \dot{y_g}(t)^2 \right)
\end{equation}

Para el componente rotacional, se tiene que la energía cinética asociada al cuerpo
corresponde a la rotación relacionada con $\theta(t)$ alrededor del centro de masa como
eje (en donde se tiene un  momento de inercia $I_g$), ya que este punto se toma como referencia para la
obtención de la energía total del cuerpo (traslacional y rotacional). De esta forma, la energía
cinética rotacional del cuerpo corresponde a la ecuación (\ref{eq:k_rot_cuerpo}).

\begin{equation}
  \label{eq:k_rot_cuerpo}
  K_{Cro} = \frac{1}{2}I_g\dot{\theta}(t)^2
\end{equation}

Al sumar las energías cinéticas de las ecuaciones (\ref{eq:k_tras_cuerpo}) y
(\ref{eq:k_rot_cuerpo}), se obtiene la energía cinética del cuerpo del vehículo, tal como se muestra
en (\ref{eq:K_carrito}), en donde se sustituyeron las variables $\dot{x_g}(t)$ y $\dot{y_g}(t)$ en términos de
$x(t)$, $y(t)$ y $\theta(t)$, para luego simplificar algebraicamente la expresión.


\begin{equation}
  \begin{aligned}
    K_c = &\frac{1}{2} m_c \left[ \dot{x}(t)^2 + \dot{y}(t)^2 - 2s \dot{\theta}(t) \left( \dot{x}(t) \sen
        (\theta(t)) - \dot{y}(t) \cos( \theta(t)) \right) + s^2
      \dot{\theta}(t)^2 \right] \\ & + \frac{1}{2} I_g \dot{ \theta}(t)  
  \end{aligned}
  \label{eq:K_carrito}
\end{equation}


Para calcular la energía cinética asociada a la rueda derecha de masa $m_w$, se obtiene en primer
lugar la expresión para la posición de dicha rueda, a partir de la constitución geométrica del
vehículo, lo cual se muestra en la ecuación (\ref{eq:pos_rueda_r}).

\begin{equation}
  \label{eq:pos_rueda_r}
  \mathbf{p_r}(t)= \left[ \begin{array}{c} x_r(t) \\ y_r(t) \end{array} \right] = \left[
    \begin{array}{c} x(t)+b\sen(\theta(t)) \\ y(t)-b\cos(\theta(t)) \end{array} \right]
\end{equation}


A partir de posición de la rueda derecha, se calcula el vector de velocidad asociado
$\mathbf{\dot{p_r}}(t)$, con el cual se obtiene la energía cinética traslacional de esta rueda, la
cual se expresa en la ecuación (\ref{eq:k_tras_rueda_r}).

\begin{equation}
  \label{eq:k_tras_rueda_r}
  K_{Rtr}=\frac{1}{2}m_w\left(\dot{x_r}(t)^2 + \dot{y_r}(t)^2\right)
\end{equation}

Con respecto al componente de energía cinética rotacional, es importante notar que esta rueda gira
tanto por la rotación sobre su eje central $\dot{\varphi_r}(t)$, asociada a $I_w$, como debido al
cambio en la orientación del robot $\dot{\theta}(t)$, en donde se tiene que la rueda gira sobre un
eje definido por un diámetro, lo cual corresponde al momento de inercia $I_m$. De esta manera, se
obtiene la energía cinética rotacional de la rueda derecha tal como se muestra en la ecuación
(\ref{eq:k_rot_rueda_r}).

\begin{equation}
  \label{eq:k_rot_rueda_r}
  K_{Rro}= \frac{1}{2}I_w\dot{\varphi_r}(t)^2 + \frac{1}{2}I_m\dot{\theta}(t)^2
\end{equation}

Al sumar las energías cinéticas de las ecuaciones (\ref{eq:k_tras_rueda_r}) y
(\ref{eq:k_rot_rueda_r}), y sustituyendo las variables $\dot{x_r}$ y $\dot{y_r}$ en términos de
$x(t)$, $y(t)$ y $\theta(t)$, se obtiene la energía cinética total de la rueda derecha, la cual se
presenta en la ecuación (\ref{eq:K_rueda derecha}).

\begin{equation}
\label{eq:K_rueda derecha}
  \begin{aligned}
    K_r= &\frac{1}{2}m_{w}\left[ \dot{x}(t)^2 + \dot{y}(t)^2 + 2b \dot{\theta}(t) \left( \dot{x}(t)
        \cos( \theta(t)) + \dot{y}(t) \sen \left( \theta(t) \right)\right) + b^2 \dot{\theta}(t)^2
    \right] \\ 
    & + \frac{1}{2} I_m  \dot{\theta}(t)^2 + \frac{1}{2} I_{w} \dot{\varphi_r}(t)^2
  \end{aligned}
\end{equation}


De manera análoga, a partir de la expresión para el vector de posición de la rueda izquierda
mostrada en la ecuación (\ref{eq:pos_rueda_l}), en conjunto con el mismo análisis realizado para la
obtención de la energía cinética en la rueda derecha, se llega a la energía cinética total de la
rueda izquierda, mostrada en la ecuación (\ref{eq:K_rueda izquierda}).

\begin{equation}
  \label{eq:pos_rueda_l}
  \mathbf{p_l}(t)= \left[ \begin{array}{c} x_l(t) \\ y_l(t) \end{array} \right] = \left[
    \begin{array}{c} x(t)-b\sen(\theta(t)) \\ y(t)+b\cos(\theta(t)) \end{array} \right]
\end{equation}


\begin{equation}
\label{eq:K_rueda izquierda}
\begin{aligned}
K_l= &\frac{1}{2}m_{w}\left[ \dot{x}(t)^2 + \dot{y}(t)^2 - 2b \dot{\theta}(t) \left( \dot{x}(t) \cos \left(
      \theta(t) \right) + \dot{y}(t)\sen \left( \theta(t) \right)\right) + b^2 \dot{\theta}(t)^2 \right] \\ & +
\frac{1}{2} I_m  \dot{\theta}(t)^2  + \frac{1}{2} I_{w} \dot{\varphi_l}(t)^2
\end{aligned}
\end{equation}


A partir de las energías del cuerpo del robot y de las ruedas, se obtiene la energía cinética total
del sistema como $K_t = K_c + K_r + K_l $, de lo cual al simplificar algebraicamente los términos se
obtiene la ecuación (\ref{eq:k_total}).

\begin{equation}
\label{eq:k_total}
\begin{aligned}
K_t = &
 \frac{1}{2} \left(m_c + 2m_{w} \right) \left[\dot{x}(t)^2+\dot{y}(t)^2 \right] - m_c s
 \dot{\theta}(t) \left[\dot{x}(t)\sen(\theta(t)) - \dot{y}(t)\cos (\theta(t)) \right] \\ 
 &  + \frac{1}{2} \left(m_c s^2 + I_g + 2m_{w}b^2 + 2 I_m \right) \dot{\theta}(t)^2 + \frac{1}{2} I_{w}\dot{\varphi_{r}}(t)^2 + \frac{1}{2} I_{w}\dot{\varphi_{l}}(t)^2
\end{aligned}
\end{equation}

Si se establecen las definiciones descritas por (\ref{eq:def_m_I}), la ecuación (\ref{eq:k_total}) se simplifica
obteniéndose la expresión de (\ref{eq:k_total_simpl}).


\begin{equation}
\begin{cases}
\begin{array}{c c}
m =& m_c + 2m_{w} \\
I =& I_g+m_c s^2 + 2m_{w}b^2 + 2 I_m 
\end{array}
\end{cases}
\label{eq:def_m_I}
\end{equation}


\begin{equation}
\label{eq:k_total_simpl}
\begin{aligned}
K_t = &
\frac{1}{2} m \left(\dot{x}(t)^2+\dot{y}(t)^2 \right) + m_c s \dot{\theta}(t) \left(\dot{y}(t)\cos
  \left(\theta(t) \right) - \dot{x}(t)\sen \left(\theta(t) \right) \right) \\ & + \frac{1}{2} I \dot{\theta}(t)^2 + \frac{1}{2} I_{w}\left(\dot{\varphi_{r}}(t)^2 + \dot{\varphi_{l}}(t)^2 \right)
\end{aligned}
\end{equation}


A continuación, para obtener las ecuaciones del movimiento se expresa la ecuación de Lagrange
respectiva para cada coordenada, lo cual se muestra en (\ref{eq:ecuaciones_lagrange}). De esta
forma, para cada una de ellas se calculan los términos relacionados con la energía cinética a partir
de la ecuación (\ref{eq:k_total_simpl}), la fuerza generalizada, y la sumatoria de términos
correspondientes a las restricciones del movimiento descritas por las ecuaciones
(\ref{eq:restriccion_1}), (\ref{eq:restriccion_2}) y (\ref{eq:restriccion_3}).

\begin{equation}
\begin{cases}
\begin{array}{c c c c c}
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{x}}\right) - \frac{\partial K_t}{\partial x} -
  \sum_{k=1}^³  \lambda_k\frac{\partial f_k}{\partial \dot{x}} &=& Q_x\\
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{y}}\right) - \frac{\partial K_t}{\partial y} -
  \sum_{k=1}^³ \lambda_k \frac{\ \partial f_k}{\partial \dot{y}} &=& Q_y\\
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{\theta}}\right) - \frac{\partial K_t}{\partial \theta} -
  \sum_{k=1}^³ \lambda_k\frac{\partial f_k}{\partial \dot{\theta}} &=& Q_{\theta}\\
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{\varphi_r}}\right) - \frac{\partial K_t}{\partial \varphi_r} -
  \sum_{k=1}^³ \lambda_k \frac{\partial f_k}{\partial \dot{\varphi_r}} &=& Q_{\varphi_r}\\
\frac{d}{dt}\left(\frac{\partial K_t}{\partial \dot{\varphi_l}}\right) - \frac{\partial K_t}{\partial \varphi_l} -
  \sum_{k=1}^³ \lambda_k \frac{\partial f_k}{\partial \dot{\varphi_l}} &=& Q_{\varphi_l}\\
\end{array}
\end{cases}
\label{eq:ecuaciones_lagrange}
\end{equation}

Con respecto a las fuerzas generalizadas, que corresponden a factores externos que modifican la
energía del sistema, se tiene que para las coordenadas $x(t)$, $y(t)$ y $\theta(t)$ estas fuerzas
son nulas, ya que no hay ningún factor externo que modifique la energía del sistema por medio de
dichas coordenadas (no hay trabajo realizado sobre el sistema por medio de estas), de lo cual se
tiene que $Q_x = Q_y = Q_{\theta} = 0$.

Sin embargo, para las coordenadas $\varphi_r(t)$ y $\varphi_l(t)$, existe respectivamente un torque
neto en cada rueda que modifica la energía del sistema al variar dichas posiciones angulares
(***REF), ya que un par de torsión aplicado sobre un cuerpo que se mueve con cierta rapidez angular
implica que está presente una potencia mecánica. Por esta razón, se cumple que
$Q_{\varphi_r}=\tau_r(t)$ y $Q_{\varphi_l}=\tau_l(t)$.

Al calcular los términos indicados para cada coordenada en (\ref{eq:ecuaciones_lagrange}), se
obtiene un sistema de ecuaciones diferenciales no lineal en donde es necesario encontrar (o
eliminar) los multiplicadores de Lagrange $\lambda_1$, $\lambda_2$ y $\lambda_3$. El sistema de
ecuaciones resultante se muestra en (\ref{eq:sistema_lagrange}), en donde se omiten los subíndices
t. Se procederá entonces a eliminar dichas incógnitas.

\begin{subequations}
  \label{eq:sistema_lagrange}
  \begin{empheq}[left = \empheqlbrace]{align}
0 &= m\ddot{x} - \ m_c s \left(\ddot{\theta} \sen \left( \theta \right) + \dot{\theta}^2 \cos \left( \theta
  \right) \right) - \lambda_1 \sen \left( \theta \right) - \left( \lambda_2 + \lambda_3 \right) \cos
\left( \theta \right)  \label{eq:sist_lagrange_x}\\
0 &= m\ddot{y} + m_c s \left(\ddot{\theta}\cos\left(\theta \right) - \dot{\theta}^2 \cos \left(\theta \right)
 \right) + \lambda_1 \cos \left(\theta \right) - \left(\lambda_2+\lambda_3\right)\sen\left(\theta\right) \label{eq:sist_lagrange_y}\\
0 &= -m_c s \left( \ddot{x} \sen\left(\theta\right) - \ddot{y}\cos\left(\theta\right) \right) +
I\ddot{\theta} + b\left(\lambda_3-\lambda_2\right) \label{eq:sist_lagrange_theta}\\
\tau_r &= I_{w}\ddot{\varphi_r}+\lambda_2 r \label{eq:sist_lagrange_phi_r}\\
\tau_l &= I_{w}\ddot{\varphi_l}+\lambda_3 r \label{eq:sist_lagrange_phi_l}
  \end{empheq}
\end{subequations}

Al multiplicar la ecuación (\ref{eq:sist_lagrange_x}) por $\cos(\theta(t))$ y al sumarle la ecuación (\ref{eq:sist_lagrange_y}) multiplicada
por $\sen(\theta(t))$, se obtiene (\ref{eq:ec_mov_1}) al simplificar la expresión algebraica.

\begin{equation}
\label{eq:ec_mov_1}
m\left(\ddot{x}(t)\cos\left(\theta(t)\right)+\ddot{y}(t)\sen\left(\theta(t)\right) \right) - m_c s
\dot{\theta}(t)^2-\left(\lambda_2 + \lambda_3\right) = 0
\end{equation}

Sumando las ecuaciones (\ref{eq:sist_lagrange_phi_r}) y (\ref{eq:sist_lagrange_phi_l}), se obtiene la expresión para $\lambda_2+\lambda_3$ que se
muestra en la ecuación (\ref{eq:lambda2+3}).

\begin{equation}
\label{eq:lambda2+3}
\lambda_2 + \lambda_3 = \frac{\tau_l(t) + \tau_r(t)}{r} - \frac{I_{w}}{R} \left(\ddot{\varphi_r}(t)+\ddot{\varphi_l}(t)\right)
\end{equation}


Se define la expresión de la ecuación (\ref{eq:vel_tras_robot}), la cual corresponde a la magnitud de
la velocidad traslacional del vehículo, y que además está restringida a presentar la dirección sobre
la línea definida por $\theta(t)$.

\begin{equation}
  \label{eq:vel_tras_robot}
  v(t)=\dot{x}(t)cos(\theta(t))+\dot{y}(t)sen(\theta(t))
\end{equation}

Derivando la ecuación (\ref{eq:vel_tras_robot}), se calcula una expresión para la aceleración
traslacional del robot, la cual se simplifica a la ecuación mostrada en (\ref{eq:acel_tras_robot}), al aplicar la
condición de no deslizamiento lateral descrita por (\ref{eq:restriccion_1}).

\begin{equation}
  \label{eq:acel_tras_robot}
  \dot{v}(t) = \ddot{x}(t)cos(\theta(t)) + \ddot{y}(t)\sen(\theta(t))
\end{equation}

Al sustituir (\ref{eq:lambda2+3}) y (\ref{eq:acel_tras_robot}) en (\ref{eq:ec_mov_1}), se obtiene la
ecuación del movimiento (\ref{eq:ec_mov_1_simpl_1}), en la cual se lograron eliminar los
multiplicadores de Lagrange.

\begin{equation}
\label{eq:ec_mov_1_simpl_1}
m\dot{v}(t) - m_c s \dot{\theta}(t)^2 + \frac{I_{w}}{r} \left(\ddot{\varphi_r}(t)+\ddot{\varphi_l}(t)\right) = \frac{\tau_l(t)+\tau_r(t)}{r}
\end{equation}

Por otro lado, al restar las ecuaciones (\ref{eq:sist_lagrange_phi_l}) y
(\ref{eq:sist_lagrange_phi_r}) se obtiene una expresión para $\lambda_3-\lambda_2$, la cual se
presenta en (\ref{eq:lambda3-2}).

\begin{equation}
\label{eq:lambda3-2}
\lambda_3 - \lambda_2 = \frac{I_{w}}{r} \left(\ddot{\varphi_r}(t)-\ddot{\varphi_l}(t)\right)-\frac{\tau_r(t)-\tau_l(t)}{r}
\end{equation}

Sustituyendo (\ref{eq:lambda3-2}) en (\ref{eq:sist_lagrange_theta}), se llega a la ecuación del
movimiento (\ref{eq:ec_mov_2_simpl_1}), en donde también se eliminaron los multiplicadores de Lagrange.


\begin{equation}
\label{eq:ec_mov_2_simpl_1}
\begin{aligned}
  &I\ddot{\theta}(t) -m_c s \left(\ddot{x}(t)\sen\left(\theta(t)\right) -\ddot{y}(t)
    \cos\left(\theta(t)\right)\right) +\frac{bI_{w}}{r}\left(\ddot{\varphi_r}(t)
    -\ddot{\varphi_l}(t)\right) \\ & = \frac{b \left(\tau_r(t)-\tau_l(t) \right)}{r}
\end{aligned}
\end{equation}


Para simplificar aún más las ecuaciones del movimiento, se utilizan las ecuaciones de las
restricciones de la condición de rodadura para cada llanta, que corresponden a
(\ref{eq:restriccion_2}) y (\ref{eq:restriccion_3}). Al sumar dichas ecuaciones y derivar el
resultado, se obtiene (\ref{eq:ddphi_r+ddphi_l}), mientras que al restar estas ecuaciones y al
derivar la expresión obtenida, se llega a la ecuación (\ref{eq:ddphi_r-ddphi_l}). Por otro lado, al
derivar la ecuación de la restricción de no deslizamiento lateral (\ref{eq:restriccion_1}), se
obtiene la expresión mostrada en (\ref{eq:wv}).

\begin{equation}
\label{eq:ddphi_r+ddphi_l}
\ddot{\varphi_r}(t) + \ddot{\varphi_l}(t) = \frac{2}{r} \dot{v}(t)
\end{equation}

\begin{equation}
\label{eq:ddphi_r-ddphi_l}
\ddot{\varphi_r}(t) - \ddot{\varphi_l}(t) = \frac{2b}{r} \ddot{\theta}(t)
\end{equation}

\begin{equation}
  \label{eq:wv}
  -\dot{\theta}(t)v(t) =
  \ddot{x}(t)\sen\left(\theta(t)\right)-\ddot{y}(t)\cos\left(\theta(t)\right)
\end{equation}

También, se definen las expresiones mostradas en (\ref{eq:FyT}), que pueden interpretarse
respectivamente como la fuerza ($F$) y el torque ($T$) totales externos aplicados sobre el sistema,
los cuales se generan debido a los torques netos en las ruedas.

\begin{equation}
\begin{cases}
\begin{array}{c c c}
F(t) &=& \frac{\tau_r(t) + \tau_l(t)}{r} \\
T(t) &=& \frac{b\left( \tau_r(t) - \tau_l(t) \right)}{r}
\end{array}
\end{cases}
\label{eq:FyT}
\end{equation}


Al sustituir (\ref{eq:ddphi_r+ddphi_l}) y (\ref{eq:FyT}) en (\ref{eq:ec_mov_1_simpl_1}), y al
sustituir (\ref{eq:ddphi_r-ddphi_l}) y (\ref{eq:FyT}) en (\ref{eq:ec_mov_2_simpl_1}), se obtienen
las ecuaciones (\ref{eq:v_dot}) y (\ref{eq:omega_dot}) respectivamente, las cuales describen el
comportamiento dinámico del sistema sujeto a las restricciones impuestas. En donde se define
$D = m + \frac{2I_{w}}{r^2}$ y $J = m + 2\frac{I_{w}}{r^2}$, los cuales se pueden interpretar como
la masa y el momento de inercia equivalentes del sistema, respectivamente.

\begin{subequations}
  \label{eq:ecs_dinamicas}
  \begin{empheq}[left = \empheqlbrace]{align}
& D\ddot{v}(t) -m_c s\ddot{\theta}(t)^2 = F(t) \label{eq:v_dot}\\
& J\ddot{\theta}(t)+m_cs\dot{\theta}(t)v(t) = T(t) \label{eq:omega_dot}
  \end{empheq}
\end{subequations}

Tal como se explicó en la descripción general del sistema por modelar, se considerará solamente la
fricción debida al contacto que se opone a la rotación alrededor del eje de cada motor, la cual se
modelará como un amortiguador viscoso torsional. 

De esta manera, el torque de la fricción aplicado sobre cada rueda es directamente proporcional a
velocidad rotacional de la rueda, tal como se presenta en la ecuación (\ref{eq:torque_friccion}). El
parámetro $B$ corresponde a una constante de proporcionalidad que determina la magnitud del torque
de oposición generado dada cierta rapidez angular \citep{stutts}, conocido como factor de amortiguamiento.

\begin{equation}
  \label{eq:torque_friccion}
  \tau_f(t) = -B\dot{\varphi}(t)
\end{equation}

Si bien es cierto este modelo de la fricción es muy simplificado y por lo tanto no describirá con
exactitud el comportamiento real del robot en movimiento, el mismo resulta en una aproximación
útil para observar de manera cualitativa los efectos básicos que podría provocar la fricción sobre
la dinámica de un robot de dos ruedas, los cuales están relacionados con la oposición a la traslación
y al cambio en la orientación del mismo.

De esta forma, se procede a descomponer los torques netos en las ruedas en términos de los torques
de los motores ($\tau_{rm}$, $\tau_{lm}$) y los de la fricción ($\tau_{rf}$, $\tau_{lf}$), en donde
se considera que el factor de amortiguamiento $B$ es el mismo para las dos ruedas. De esta forma, se
obtienen las ecuaciones (\ref{eq:torque_r}) y (\ref{eq:torque_l}).

\begin{equation}
  \label{eq:torque_r}
  \tau_r(t) = \tau_{rm}(t) - B\dot{\varphi_r}(t)
\end{equation}

\begin{equation}
  \label{eq:torque_l}
  \tau_l(t) = \tau_{lm}(t) - B\dot{\varphi_l}(t)
\end{equation}

Al sustituir las ecuaciones (\ref{eq:torque_r}) y (\ref{eq:torque_l}) en (\ref{eq:FyT}), y al
expresar el resultado en términos de $v(t)$ y $\dot{\theta}(t)$ por medio de las restricciones
expuestas en (\ref{eq:restriccion_2}) y (\ref{eq:restriccion_3}), se obtienen las expresiones de
(\ref{eq:FyT_friccion}). En donde se define $F_m(t) = \frac{\tau_r(t)+\tau_l(t)}{r}$ y
$T_m(t) = \frac{b(\tau_r(t)-\tau_l(t))}{r}$.

\begin{equation}
\begin{cases}
\begin{array}{c c c}
F(t) &=& F_m(t)-\frac{2 B}{r^2}v(t) \\
T(t) &=& T_m(t)-\frac{2 B b^2}{r^2}\dot{\theta}(t)
\end{array}
\end{cases}
\label{eq:FyT_friccion}
\end{equation}

Al sustituir las expresiones de (\ref{eq:FyT_friccion}) en (\ref{eq:ecs_dinamicas}), se obtienen
las ecuaciones dinámicas (\ref{eq:v_dot_friccion}) y (\ref{eq:omega_dot_friccion}), que están en
términos de la fuerza ($F_m(t)$) y el torque ($T_m(t)$) equivalente aplicado por los motores sobre
el robot. Estas ecuaciones se utilizarán para obtener el modelo en variables de estado
correspondiente.

\begin{subequations}
  \label{eq:ecs_dinamicas_friccion}
  \begin{empheq}[left = \empheqlbrace]{align}
    & D\ddot{v}(t) -m_c s\ddot{\theta}(t)^2 + \frac{2 B}{r^2}v(t) = F_m(t) \label{eq:v_dot_friccion}\\
    & J\ddot{\theta}(t)+m_cs\dot{\theta}(t)v(t) + \frac{2 B b^2}{r^2}\dot{\theta}(t) =
    T_m(t) \label{eq:omega_dot_friccion}
  \end{empheq}
\end{subequations}

Se define entonces el vector de estados, el cual se muestra en la ecuación (\ref{eq:vect_estados}).

\begin{equation}
  \label{eq:vect_estados}
  \mathbf{X}(t)= \left[ \begin{array}{c} x(t) \\ y(t) \\ \theta(t) \\ v(t) \\ \omega(t) \end{array} \right]
\end{equation}

De esta manera, en (\ref{eq:mve_dinamico}) se presentan las derivadas de los estados del
modelo en variables de estado no lineal que describe al sistema, en donde las ecuaciones de
$\dot{x}(t)$ y $\dot{y}(t)$ corresponden a los componentes de la velocidad del centro geométrico
sobre los ejes cartesianos, la ecuación de $\dot{\theta}(t)$ resulta de la definición de la rapidez
angular de cambio en la orientación del robot $\omega(t)$ y las ecuaciones de $\dot{v}(t)$ y
$\dot{\omega}(t)$ se obtienen del análisis dinámico del sistema descrito previamente.

\begin{equation}
  \label{eq:mve_dinamico}
   \mathbf{\dot{X}}(t) = \left[\begin{array}{c}
      \dot{x}(t)\\\dot{y}(t)\\\dot{\theta}(t)\\\dot{v}(t)\\\dot{\omega}(t)
    \end{array}\right]
  = \left[\begin{array}{c}
      v(t)\cos\left(\theta(t)\right) \\
      v(t)\sen\left(\theta(t)\right) \\
      \omega(t)\\
      \frac{m_c s}{D} \omega(t)^2 - \frac{2 B}{Dr^2}v(t)  + \frac{F(t)}{D} \\
      \frac{-m_c s}{J}\omega(t)v(t) - \frac{2 B b^2}{Jr^2}\omega(t)  + \frac{T(t)}{J}
    \end{array}\right]
%& \dot{x}(t) = v(t)\cos\left(\theta(t)\right) \label{eq:x_dot_mve}\\
%& \dot{y}(t) = v(t)\sin\left(\theta(t)\right) \label{eq:y_dot_mve}\\
%& \dot{\theta}(t) = \omega(t)\label{eq:theta_dot_mve}\\
%& \dot{v}(t)=\frac{m_c s}{D} \omega(t)^2 - \frac{2 B}{Dr^2}v(t)  + \frac{F(t)}{D} \label{eq:v_dot_mve}\\
%& \dot{\omega}(t) = \frac{-m_c s}{J}\omega(t)v(t) - \frac{2 B b^2}{Jr^2}\omega(t)  + \frac{T(t)}{J} \label{eq:omega_dot_mve}\\
\end{equation}

Además, para completar la definición formal del modelo en variables de estado, las salidas de
interés del sistema se indican mediante la ecuación (\ref{eq:salidas_mve_dinamico}), en donde se
incluyen las velocidades angulares de las ruedas, obtenidas en términos de los estados con base en
(\ref{eq:restriccion_2}) y (\ref{eq:restriccion_3}). Por otro lado, las entradas del sistema se
presentan mediante el vector indicado en (\ref{eq:entradas_mve_dinamico}).

\begin{equation}
  \label{eq:salidas_mve_dinamico}
  \mathbf{Y}(t) = \left[
    \begin{array}{c}
      x(t)\\y(t)\\\theta(t)\\v(t)\\\omega(t)\\\dot{\varphi_r}(t)\\\dot{\varphi_l}(t)
    \end{array}
\right] 
= \left[\begin{array}{c c c c c}
  1 &0 &0 &0 &0 \\
  0 &1 &0 &0 &0 \\
  0 &0 &1 &0 &0 \\
  0 &0 &0 &1 &0 \\
  0 &0 &0 &0 &1 \\
  0 &0 &0 &\frac{1}{r} & \frac{b}{r} \\
  0 &0 &0 &\frac{1}{r} & -\frac{b}{r} \\
\end{array} \right] \mathbf{X}(t) 
\end{equation}

\begin{equation}
  \label{eq:entradas_mve_dinamico}
  \mathbf{U}(t) = \left[ 
    \begin{array}{c}
      \tau_r(t)\\\tau_l(t)
    \end{array}
  \right]
\end{equation}

\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/backup/caja_dinamico.pdf}	
	\caption{Caja negra del modelo Dinámico }
	\label{fig:evaluacion_de_la_restriccion_cuadrado}
\end{figure}

\section{Análisis y simulaciones}

En este apartado, se procede a realizar el análisis y las simulaciones respectivas al modelo
cinemático y al modelo dinámico, obtenidas en la sección de modelado para el robot de dos
ruedas. Para las simulaciones, se toman las características del robot real indicadas por
\cite{sarkar}, las cuales se presentan en (\ref{eq:datos_robot_sim}).

\begin{equation}
\begin{cases}
\begin{array}{c c c}
I_c &=& 15.625 \hspace{0.1cm} kg \cdot m^2\\
I_{w} &=& 0.005 \hspace{0.1cm} kg \cdot m^2\\
I_m &=& 0.0025 \hspace{0.1cm} kg \cdot m^2\\
b &=& 0.75 \hspace{0.1cm} m\\
s &=& 0.3 \hspace{0.1cm} m\\
m_c &=& 30 \hspace{0.1cm} kg\\
m_{w} &=& 1 \hspace{0.1cm} kg\\
r &=& 0.10 \hspace{0.1cm} m
\end{array}
\end{cases}
\label{eq:datos_robot_sim}
\end{equation}



\subsection{Modelo Cinemático}
Se realizaron tres simulaciones. Las tres se diferencian porque se tiene el mismo proceso pero con entradas distintas. Primero se explica el proceso, y luego las entradas. 


Se recibe la velocidad traslacional requerida del punto descentralizado $\mathbf{p_d}(t)$. Este vector se utiliza como la entrada al modelo del punto descentralizado inverso. De esta manera se obtienen las velocidades en las ruedas $\mathbf{\dot{\varphi}}(t)$ requeridas para lograr las velocidades de entrada. Esta velocidad, en algunos casos puede tener puntos de discontinuidades, que provocan una derivada infinita. Como es sabido que esto no es posible en el mundo real, entonces se pasa la señal de las ruedas por un sistema cuya función de transferencia es $\frac{10}{s+10}$. De esta manera se logra suavizar la función, y evitar una salida que sea imposible en la realidad. Una vez, se tienen estas velocidades ($\mathbf{\dot{\varphi_S}}(t)$), entonces e utilizan como la entrada a los modelos directos. De esta manera se obtiene la velocidad del centro del robot $\mathbf{\nu_S}(t)$, y la velocidad del punto descentralizado $\mathbf{\dot{p_{e_S}}}(t)$,que generan las velocidades de las ruedas suavizadas. Finalmente se integran $\mathbf{\nu_S}(t)$ y $\mathbf{\dot{p_{e_S}}}(t)$, para obtener la posición del robot a través del tiempo. Un resumen de la simulación se muestra en la figura \ref{fig:simulacion_flow}. El proceso de suavizar la función de las ruedas es importante porque luego se utilizó como entrada del modelo dinámico, y no se pueden tener entradas de aceleración infinita.  


\begin{figure}
	\centering
	\includegraphics[width=0.8\textwidth]{../pictures/simulacion_flow.pdf}	
	\caption{Flujo de la simulación}
	\label{fig:simulacion_flow}
\end{figure}

En cada simulación el robot describió una trayectoria distinta, y esta trayectoria defina la entrada. En la primera fue una trayectoria cuadrada a rapidez constante, la segunda es una trayectoria circular a rapidez constante, y la tercera es una trayectoria cuadrada pero con desaceleración cuando el robot se acerca a las esquinas del cuadrado. En todos los casos, el robot comienza en el origen con $\theta=0$. Además se utilizan los parámetros que se toman del robot real.

\subsubsection{Primera simulación: trayectoria cuadrada}

Para poder generar la primera trayectoria se utilizan escalones en la entrada. La velocidad de la trayectoria viene dada por (\ref{eq:entrada_cuadrado}). De esta manera se logra describir una trayectoria cuadrada con rapidez constante (durante 20s). En la figura \ref{fig:entrada_trayectoria_cuadrada} se muestra la entrada contra el tiempo. Luego de pocesar la entrada como se indica en la figura \ref{fig:simulacion_flow}, se obtienen los resultados en las figuras \ref{fig:posicion_del_robot_modelo_cinematico_cuadrado}, \ref{fig:velocidades_ruedas_trayectoria_cuadrada} y \ref{fig:evaluacion_de_la_restriccion_cuadrado}. 

\begin{equation}
\mathbf{\dot{p_d}}(t)=\left[\begin{array}{c}\mu(t-5)-\mu(t-10)-\mu(t-15)\\ \mu(t)-\mu(t-5)-\mu(t-10)+\mu(t-15) \end{array}\right]
\label{eq:entrada_cuadrado}
\end{equation}

La salida del modelo inverso del punto descentralizado se muestra en la figura \ref{fig:velocidad_de_las_ruedas_obtenidas_del_modelo_inverso_cuadrado}. Note que cuando el robot llega a las esquinas de la trayectoria, se tienen discontinuidades en las velocidades de las ruedas. Esto es en 0s, 5s, 10s, 15s. En cada uno de ellos el robot debe realizar un giro de $90^\circ$ a rapidez constante, y es lo que provocan las discontinuidades. En la figura \ref{fig:velocidad_de_las_ruedas_con_limitantes_de_aceleracion_cuadrado} se muestra la señal suavizada. en esta se evitan las discontinuidades de la salida del modelo inverso. Note que las discontinuidades indican aceleraciones infinitas, por lo que es imposible para un robot realizar una trayectoria cuadrada perfecta a rapidez constante. Este resultado es el esperado para el sistema que se está simulando. 

Note también que la salida de las ruedas es la esperada, dada la trayectoria que se debe seguir. por ejemplo, cada vez que el robot gira a la derecha (5s, 10s, 15s) se espera un aumento en la velocidad de la rueda izquierda y una disminución de la rueda derecha. Además, cuando no se realizan giros, sino que se sigue una trayectoria recta, se espera que las velocidades tienden a un mismo valor. Estos resultados soniciden son los que se muestran en la figura \ref{fig:velocidad_de_las_ruedas_obtenidas_del_modelo_inverso_cuadrado}.

La función de las velocidades angulares de las ruedas suavizadas (figura \ref{fig:velocidad_de_las_ruedas_con_limitantes_de_aceleracion_cuadrado}), se utiliza como la entrada para el modelo directo del punto descentralizado. Note que estas velocidades ya no son las que producen la trayectoria cuadrada perfecta, sino que se espera una trayectoria similar, pero deformada (se le llama $\phi$). En la figura   \ref{fig:posicion_del_robot_modelo_cinematico_cuadrado} se muestra el resultado de la posición del punto descentralizado a través del tiempo, provocado por las velocidades de la figura \ref{fig:velocidad_de_las_ruedas_con_limitantes_de_aceleracion_cuadrado}. Cuando $\phi$ describe porciones rectas, coincide con el cuadrado, sin embargo en las esquinas, se presentan cambios. Se debe notar que $\phi$ tiene sus esquinas redondeadas. Esto se debe al suavizamiento que se le realiza a la entrada del sistema. Este resultado es el esperado. Ya que las diferencias más grandes entre las velocidades de las ruedas, y las velocidades suavizadas (ver figura \ref{fig:velocidades_ruedas_trayectoria_cuadrada}) se dan cuando el robot se encuentra en las esquinas. Entonces las trayectorias descritas por el robot, deben tener mayores diferencias en las esquinas.

Finalmente se analiza el resultado del centro del robot. Las velocidades suavizadas de las ruedas son la entrada al modelo directo del punto central del robot. Es de esperarse que la trayectoria que describe el punto central del robot no sea la misma que la que describe el punto descentralizado, ya que con el método del punto descentralizado no se puede controlar la orientación. Sin embargo es evidente que cuando el robot describe trayectorias rectas, la posición del centro del robot se aproxima a la trayectoria del punto descentralizado. Además la orientación del robot cada vez se asemeja más a la que describe la trayectoria del punto descentralizado. Con este resultado se comprueba la validez del modelo del punto descentralizado, ya que sí logra describir una buena aproximación de la posición del robot. Cuando el robot realiza un giro se evidencia una diferencia entre el centro del robot y la trayectoria cuadrada, pero este se corrige cuando el robot se mueve en la  porción recta. TOmando en cuenta el análisis cuantitativo, se mide de las gráficas en \ref{fig:velocidades_ruedas_trayectoria_cuadrada} que la velocidad de las ruedas es de $10 rad/s$ en los trayectos rectos. Como  el radio de las ruedas cumple que $r=0.1$, y no se consideran deslizamientos de las ruedas. Entonces se obtiene una velocidad traslacional de $1m/s$, que es exactamente la que se introduce como entrada.   


%**********Entradas de las simulaciones*******************************************************************
 \begin{figure}
 	\centering
 	\begin{subfigure}[t]{0.48\textwidth}
 		\includegraphics[width=\textwidth]{../pictures/entrada_trayectoria_cuadrada.eps}
 		\caption{Velocidades para generar el cuadrado}
 		\label{fig:entrada_trayectoria_cuadrada}
 	\end{subfigure}
 	\begin{subfigure}[t]{0.48\textwidth}
 		\includegraphics[width=\textwidth]{../pictures/entrada_trayectoria_circular.eps}
 		\caption{Velocidades para generar el círculo}
 		\label{fig:entrada_trayectoria_circular}
 	\end{subfigure}

 	\begin{subfigure}[b]{0.48\textwidth}
 		\includegraphics[width=\textwidth]{../pictures/entrada_trayectoria_cuadrada_suavizada.eps}
 		\caption{Velocidades para generar el cuadrado con desaceleración en las esquinas}
 		\label{fig:entrada_trayectoria_cuadrada_suavizada}
 	\end{subfigure}
        \caption{Entradas de las simulaciones}
        \label{fig:entradas_simulaciones_cinematico}
 \end{figure}


%******Posicion trayectoria cuadrada***********************************************************************
\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/posicion_del_robot_modelo_cinematico_cuadrado.eps}	
	\caption{Posición del robot en la trayectoria cuadrada}
	\label{fig:posicion_del_robot_modelo_cinematico_cuadrado}
\end{figure}

 \begin{figure}
 	\centering
 	\begin{subfigure}[t]{0.48\textwidth}
 		\includegraphics[width=\textwidth]{../pictures/velocidad_de_las_ruedas_obtenidas_del_modelo_inverso_cuadrado.eps}
 		\caption{Velocidad de las ruedas obtenidas del modelo inverso}
 		\label{fig:velocidad_de_las_ruedas_obtenidas_del_modelo_inverso_cuadrado}
 	\end{subfigure}
 	\begin{subfigure}[t]{0.48\textwidth}
 		\includegraphics[width=\textwidth]{../pictures/velocidad_de_las_ruedas_con_limitantes_de_aceleracion_cuadrado.eps}
 		\caption{Velocidad de las ruedas con limitantes de aceleración}
 		\label{fig:velocidad_de_las_ruedas_con_limitantes_de_aceleracion_cuadrado}
 	\end{subfigure}
        \caption{Velocidades de las ruedas par la trayectoria cuadrada}
        \label{fig:velocidades_ruedas_trayectoria_cuadrada}
 \end{figure}

\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/evaluacion_de_la_restriccion_cuadrado.eps}	
	\caption{Evaluación de la restricción para la trayectoria cuadrada}
	\label{fig:evaluacion_de_la_restriccion_cuadrado}
\end{figure}


\subsubsection{Segunda simulación: trayectoria circular}

Para poder generar la segunda trayectoria se utilizan funciones trigonométricas en la entrada. La velocidad de la trayectoria viene dada por (\ref{eq:entrada_circular}). De esta manera se logra describir una trayectoria circular con rapidez constante (durante 20s). En la figura \ref{fig:entrada_trayectoria_circular} se mestra la entrada contra el tiempo. Luego de pocesar la entrada como se indica en la figura \ref{fig:simulacion_flow}, se obtienen los resultados en las figuras \ref{fig:posicion_del_robot_modelo_cinematico_circulo}, \ref{fig:velocidades_ruedas_trayectoria_circulo} y \ref{fig:evaluacion_de_la_restriccion_circulo}.

\begin{equation}
\mathbf{\dot{p_d}}(t)=\left[\begin{array}{c} 2\sen(t)\\ 2\cos(t) \end{array}\right]
\label{eq:entrada_circular}
\end{equation}


En esta simulación, a diferencia de la primera, la trayectoria se completa más de una vez. Esto se debe a que la trayectoria del centro del robot no llega a coincidir con la trayectoria del punto descentralizado (ver figura \ref{fig:posicion_del_robot_modelo_cinematico_circulo}), entonces se hace al robot girar más veces sobre la trayectoria, para averiguar si esta condición cambia cuando t aumenta. Se completan poco más de tres revoluciones, y no se observan cambios en la condición descrita. SE pueden apreciar puntos de corte entre las trayectorias, pero no se tiene un comportamiento asintótico, que sí se tiene en los trayectos rectos. Se puede apreciar que en general, la trayectoria del centro del robot se encuentra dentro de la trayectoria del punto descentralizado (los que se obtienen de los modelos directos). En la figura \ref{fig:posicion_del_robot_modelo_cinematico_cuadrado}, se nota que cuando el robot gira, la trayectoria del centro, se encuentra hacia adentro. Si se considera al círculo como un giro contínuo, entonces ambos resultados son consistentes. %Sinembargo, note que como el círculo es lo suficientemente grande, entonces ambas trayectorias están cercanas, ya que entre mayor sea el radio del círculo, mayor será su semejanza con una trayectoria recta, y por tanto las trayectorias del dentro y el punto descentralizado se vana a asemejar más.  

  También se debe analizar lo que se muestra en la figura \ref{fig:velocidades_ruedas_trayectoria_circulo}. Estas son las velocidades angulares de las ruedas que generan las trayectorias en la figura \ref{fig:posicion_del_robot_modelo_cinematico_circulo}. Estas presentan el comportamiento esperado. Al inicio se tiene un comportamiento con aceleraciones elevadas, esto se debe a que el robot se encuentra perpendicular a la trayectoria. Sin embargo, conforme avanza el tiempo, las velocidades se estabilizan en un valor, que es lo que permite que se describa el círculo. De las gáfiacas, se miden los valores donde se estabilizan las velocidades angulares de las ruedas, y se obtiene $27.7rad/s$ para la rueda izquierda, y $12.27rad/s$ para la rueda derecha. Note que como el robot se encuentra avanzando hacia su frente, entonces se esperan valores positivos, y como el robot gira hacia su derecha, se espera qeu la velocidad de la rueda izquierda sea mayor. 

Ahora, respecto al valor numérico de estos valores finales, se debe considerar que estos se tienen cuando ya el robot se encuentra describiendo un círculo. De la figura  \ref{fig:posicion_del_robot_modelo_cinematico_circulo} se puede concluir que el radio $R$ de la trayectoria circular que describe el centro del robot es aproximadamente $1.977m$ (midiendo los extremos de la posición en y). De la ecuación (\ref{eq:entrada_circular}), se sabe que la magnitud de la velocidad tangencial al círculo del robot viene dada por $v_0=\sqrt{4\cos^2(t)+4\sen^2(t)}=2$. Se considera a $\rho$ como la velocidad angular alrededor del círculo, entonces se tiene que $\rho=v_0/R=1.012 rad/s$. 

Como el robot diferencial tiene la restricción que solo se puede mover hacia el frente (o hacia atrás pero no hacia los lados). Se puede suponer que el robot se encuentra perpendicular al radio de la trayectoria circular. Se sabe que el ancho del robot es $1.5m$, entonces la trayectoria que describe la rueda derecha tiene un radio de $R_r=R-0.75=1.25m$, y la rueda izquierda de $R_l=R+0.75=2.75m$. Conociendo la velocidad angular y el radio de cada rueda, se determina la velocidad traslacional. $v_r=\rho R_r= 1.265m/s$, y $v_l=\rho R_l= 2.783m/s$. Tomando en cuenta que $r=0.01$. se obtiene que la velocidad de la ruda derecha debe ser $27.83rad/s$, y en la izquierda $12.65rad/s$. Estos valores son muy cercanos a los obtenidos en la simulación, entonces los resultados simulados son los esperados para el sistema en cuestión.



%******Posicion trayectoria circular***********************************************************************
\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/posicion_del_robot_modelo_cinematico_circulo.eps}	
	\caption{Posición del robot en la trayectoria circular}
	\label{fig:posicion_del_robot_modelo_cinematico_circulo}
\end{figure}

\begin{figure}
 	\centering
 	\begin{subfigure}[t]{0.48\textwidth}
 		\includegraphics[width=\textwidth]{../pictures/velocidad_de_las_ruedas_obtenidas_del_modelo_inverso_circulo.eps}
 		\caption{Velocidad de las ruedas obtenidas del modelo inverso}
 		\label{fig:velocidad_de_las_ruedas_obtenidas_del_modelo_inverso_circulo}
 	\end{subfigure}
 	\begin{subfigure}[t]{0.48\textwidth}
 		\includegraphics[width=\textwidth]{../pictures/velocidad_de_las_ruedas_con_limitantes_de_aceleracion_circulo.eps}
 		\caption{Velocidad de las ruedas con limitantes de aceleración}
 		\label{fig:velocidad_de_las_ruedas_con_limitantes_de_aceleracion_circulo}
 	\end{subfigure}
        \caption{Velocidades de las ruedas par la trayectoria circular}
        \label{fig:velocidades_ruedas_trayectoria_circulo}
 \end{figure}

\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/evaluacion_de_la_restriccion_circulo.eps}	
	\caption{Evaluación de la restricción para la trayectoria circular}
	\label{fig:evaluacion_de_la_restriccion_circulo}
\end{figure}

\subsubsection{Tercera simulación: trayectoria cuadrada con desaceleración en las esquinas}

Para poder generar la primera trayectoria se utilizan escalones en la entrada. La velocidad de la trayectoria viene dada por (\ref{eq:entrada_cuadrado_suavizado}). De esta manera se logra describir una trayectoria cuadrada con rapidez constante (durante 20s). En la figura \ref{fig:entrada_trayectoria_cuadrada_suavizada} se muestra la entrada contra el tiempo. Luego de pocesar la entrada como se indica en la figura \ref{fig:simulacion_flow}, se obtienen los resultados en las figuras \ref{fig:posicion_del_robot_modelo_cinematico_cuadrado_suavizado}, \ref{fig:velocidades_ruedas_trayectoria_cuadrada_suavizado}, \ref{fig:evaluacion_de_la_restriccion_cuadrado}, y \ref{fig:zoom_trayectoria_cuadrada_suavizada}. 

\begin{equation}
\mathbf{\dot{p_d}}(t)=\left[\begin{array}{c}(\mu(t-5)-\mu(t-10))(1-\cos(\pi (t-5)/5))-\mu(t-15)(1-\cos(\pi (t-15)/5))\\
 (\mu(t)-\mu(t-5))(1-\cos(\pi t/5))-(\mu(t-10)+\mu(t-15))(1-\cos(\pi (t-10)/5)) \end{array}\right]
\label{eq:entrada_cuadrado_suavizado}
\end{equation}

Para poder generar la primera trayectoria se utilizan escalones en la entrada. La velocidad de la trayectoria viene dada por (\ref{eq:entrada_cuadrado_suavizado}). De esta manera se logra describir una trayectoria cuadrada con rapidez constante (durante 20s). En la figura \ref{fig:entrada_trayectoria_cuadrada_suavizada} se muestra la entrada contra el tiempo. Luego de pocesar la entrada como se indica en la figura \ref{fig:simulacion_flow}, se obtienen los resultados en las figuras \ref{fig:posicion_del_robot_modelo_cinematico_cuadrado_suavizado}, \ref{fig:velocidades_ruedas_trayectoria_cuadrada_suavizado}, \ref{fig:evaluacion_de_la_restriccion_cuadrado}, y \ref{fig:zoom_trayectoria_cuadrada_suavizada}. 

\begin{equation}
\mathbf{\dot{p_d}}(t)=\left[\begin{array}{c}(\mu(t-5)-\mu(t-10))(1-\cos(\pi (t-5)/5))-\mu(t-15)(1-\cos(\pi (t-15)/5))\\
 (\mu(t)-\mu(t-5))(1-\cos(\pi t/5))-(\mu(t-10)+\mu(t-15))(1-\cos(\pi (t-10)/5)) \end{array}\right]
\label{eq:entrada_cuadrado_suavizado}
\end{equation}

Esta simulación se realiza como un método alternativo para evitar las discontinuidades en las velocidades angulares de las ruedas. Se construye la entrada de manera que se describa una trayectoria cuadrada, pero que el robot desacelera cuando se acerca a las esquinas del cuadrado. Para evitar los cambios abruptos en las velocidades de los motores, se espera que en cada esquina la velocidad traslacional del robot sea nula. Como se desea construir una trayectoria cuadrada, en periodos no se tiene traslación en x, y en otros periodos no se tiene traslación en y. Estos cambios ocurren al llegar a las esquinas, entonces la señal de entrada debe tener una derivada de 0 al llegar a una esquina. En síntesis se necesita una señal de entrada que sea contínua, pueda describir una trayectoria cuadrada, y su derivada sea también contínua. ESto se logra con la función en \ref{eq:entrada_cuadrado_suavizado}. Que la entrada pueda describir una trayectoria cuadrada, se logra con los escalones, para evitar desplazamiento en ambas dimensiones al mismo tiempo. Y la continuidad de la función y su derivada, se logra con la parte de los cosenos. De la figura \ref{eq:entrada_cuadrado_suavizado} es evidente que la función de entrada cumple con los requerimientos. 

De las gráficas que se presentan en la figura \ref{fig:velocidades_ruedas_trayectoria_cuadrada_suavizado}, se nota que no tienen discontinuidades, por lo que con la entrada propuesta se logran tener velocidades en las ruedas cuya aceleración sea finita en todo punto. Además cabe destacar que ambas gráficas (\ref{fig:velocidad_de_las_ruedas_obtenidas_del_modelo_inverso_cuadrado_suavizado} y\ref{fig:velocidad_de_las_ruedas_con_limitantes_de_aceleracion_cuadrado_suavizado}) presentan comportamientos sumamente parecidos. Esto significa que los comandos que envía el robot a sus motores son muy cercanos a los que se necesitan para poder describir la trayectoria cuadrada con su punto descentralizado. Este hecho se hace evidente al observar la figura \ref{fig:zoom_trayectoria_cuadrada_suavizada}. En esta se presenta una porción de la trayectoria, que muestra una esquina. Se debe notar que en este caso (a diferencia de la trayectoria cuadrada a rapidez constante), el robot sí puede describir el giro de $90^\circ$ que se requiere para tener un cuadrado.  Por otra parte, el comportamiento del centro del robot es asintótico al del punto descentralizado, cuando se tienen trayectorias rectas. 
 

%******Posicion trayectoria cuadrada suavizada**************************************************************
\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/posicion_del_robot_modelo_cinematico_cuadrado_suavizado.eps}	
	\caption{Posición del robot en la trayectoria cuadrada con desaceleración en las esquinas}
	\label{fig:posicion_del_robot_modelo_cinematico_cuadrado_suavizado}
\end{figure}

\begin{figure}
 	\centering
 	\begin{subfigure}[t]{0.48\textwidth}
 		\includegraphics[width=\textwidth]{../pictures/velocidad_de_las_ruedas_obtenidas_del_modelo_inverso_cuadrado_suavizado.eps}
 		\caption{Velocidad de las ruedas obtenidas del modelo inverso}
 		\label{fig:velocidad_de_las_ruedas_obtenidas_del_modelo_inverso_cuadrado_suavizado}
 	\end{subfigure}
 	\begin{subfigure}[t]{0.48\textwidth}
 		\includegraphics[width=\textwidth]{../pictures/velocidad_de_las_ruedas_con_limitantes_de_aceleracion_cuadrado_suavizado.eps}
 		\caption{Velocidad de las ruedas con limitantes de aceleración}
 		\label{fig:velocidad_de_las_ruedas_con_limitantes_de_aceleracion_cuadrado_suavizado}
 	\end{subfigure}
        \caption{Velocidades de las ruedas par la trayectoria cuadrada con desaceleración en las esquinas}
        \label{fig:velocidades_ruedas_trayectoria_cuadrada_suavizado}
 \end{figure}

\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/evaluacion_de_la_restriccion_cuadrado_suavizado.eps}	
	\caption{Evaluación de la restricción para la trayectoria cuadrada}
	\label{fig:evaluacion_de_la_restriccion_cuadrado_suavizado}
\end{figure}


\begin{figure}
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/zoom_trayectoria_cuadrada_suavizada.eps}	
	\caption{Trayectoria cuadrada con desaceleración en una esquina}
	\label{fig:zoom_trayectoria_cuadrada_suavizada}
\end{figure}

\subsection{Los errores de resticciones}

El modelo dinámico tiene una restricción en la dirección del movimiento. La que se expresa en la ecuación (\ref{eq:restriccion_1}). Sin embargo esta restricción nos e define para el modelo cinemático. Esta es una limitación en el movimiento del robot, por lo que es importante comprobar que la salida del modelo cinemático sea consistente con las restricciones naturales del sistema. Para esto se obtiene la magnitud e la velocidad del robot y se calcula la expresión en (\ref{eq:restriccion_1}), sin igualar a cero, sino que se calcula el valor. Este resultado se grafica para las 3 simulaciones, y se presenta en las figuras \ref{fig:evaluacion_de_la_restriccion_cuadrado_suavizado}, \ref{fig:evaluacion_de_la_restriccion_cuadrado} y \ref{fig:evaluacion_de_la_restriccion_circulo}.

Primero se debe notar que el error es despreciable. Con un orden de magnitud máximo de $10^{-16}$. Por lo que se puede considerar que del modelo cinemático se obtienen respuestas que son consistentes con las restricciones de movimiento del robot. y por tanto son válidos para poder controlar al robot sin pedirle condiciones que violen estas condiciones.  Note que en todos los casos se presentan más errores cuando el robot se encuentra girando. Esto porque una condición de deslizamiento lateral es más fácil de alcanzar si se está girando qeu si se avanza en línea recta. Por esot también el círculo permanece son un error alto durante toda la trayectoria. 

Por otra parte, el suavizamiento de la señal de los motores, a¡también agrega errores. Ya que al suavizar la función para evitar aceleraciones infinitas no se suaviza o amortigua a todas las rueda spor igual. Este amortiguamiento, ocurre sin tomar las restricciones en cuenta. Este amortiguamiento se hace más importante en los giros, porque es donde se dan las discontinuidades. y por tanto en los giros se espera un mayor error. EStas dos razones son las que provocan los errores observados, pero como se mencionó anteriormente, el aporte es despreciable. 










\subsection{Modelo dinámico}
Para estudiar el comportamiento del modelo dinámico obtenido del sistema, descrito por las
ecuaciones (\ref{eq:mve_dinamico}), (\ref{eq:entradas_mve_dinamico}) y (\ref{eq:salidas_mve_dinamico}), se
procederá a llevar a cabo una serie de simulaciones en donde se analiza la respuesta del mismo al
aplicar distintas funciones de entrada. 

\subsubsection{Simulación torques constantes y opuestos}
En esta simulación se aplica la entrada que se muestra en la figura
(\ref{fig:entrada_torques_constantes_opuestos}), en donde se observa que los torques aplicados de
las ruedas son de la misma magnitud constante igual a uno pero de signo contrario. De esta forma, se tiene que
la fuerza equivalente $F_m(t)$ definida en (\ref{eq:FyT_friccion}) se vuelve nula, la cual afecta de
manera directa a la derivada de la velocidad del punto central $v(t)$. Se establecen condiciones
iniciales nulas para todos los estados del sistema. También, para esta simulación se establece 
el factor de amortiguamiento como $B=0.001\hspace{0.1cm} N s$.


\begin{figure}[ht]
  \centering
  \includegraphics[width=0.5\linewidth]{../pictures/sim_modelo_dinamico/torques_m_dinamico-Prueba_de_torques_opuestos.eps}
  \caption{Entradas del modelo dinámico con respecto al tiempo. \\Simulación de torques constantes y opuestos}
  \label{fig:entrada_torques_constantes_opuestos}
\end{figure}

En la figura \ref{fig:entrada_torques_constantes_opuestos}, se muestra la trayectoria que describe
el robot en el plano XY, en donde se tiene que el mismo se desplaza desde el origen hacia afuera,
siguiendo una trayectoria en espiral que se tiende a estabilizar a una curva de forma prácticamente
circular a medida que trascurre el tiempo de simulación. Esto se reafirma a partir de la gráfica de
la figura \ref{fig:posicion_vs_t_torques_constantes_opuestos}, en donde se observa que para tiempos
grandes la forma de las gráficas de $x(t)$ y $y(t)$ es sinusoidal con un desfase cercano a 90
grados entre estas.


\begin{figure}
 	\centering
 	\begin{subfigure}[t]{0.48\textwidth}
            \includegraphics[width=\textwidth]{../pictures/sim_modelo_dinamico/trayect_m_dinamico-Prueba_de_torques_opuestos.eps}
            \caption{Trayectoria en el plano XY}
            \label{fig:trayect_robot_torques_constantes_opuestos}
 	\end{subfigure}
 	\begin{subfigure}[t]{0.48\textwidth}
            \includegraphics[width=\textwidth]{../pictures/sim_modelo_dinamico/posicion_vs_tiempo-Prueba_de_torques_opuestos.eps}
            \caption{Posición en X y Y con respecto \\al tiempo}
            \label{fig:posicion_vs_t_torques_constantes_opuestos}
 	\end{subfigure}
        \caption{Posición del centro geométrico del robot.\\ Simulación de torques constantes y opuestos}
        \label{fig:pos_centro_geometrico_torques_constantes_opuestos}
 \end{figure}

 Este comportamiento del sistema se puede explicar mediante la gráfica
 \ref{fig:v_w_vs_t_torques_constantes_opuestos}, que corresponde a la velocidad traslacional del
 robot $v(t)$ y a la velocidad angular $\omega(t)$ del mismo, en conjunto con las ecuaciones para
 $\dot{x}(t)$ y $\dot{y}(t)$ mostradas en (\ref{eq:mve_dinamico}). En dicha gráfica, se observa que al
 inicio de la simulación hay una importante aceleración angular y traslacional del robot, expresadas
 mediante la pendiente de las curvas de $v(t)$ y $\omega(t)$, lo cual provoca en primer lugar que
 cambie el factor $v$ que multipica a $\sen(\theta(t))$ y $\cos(\theta(t))$ en las ecuaciones de
 $\dot{x}(t)$ y $\dot{y}(t)$. El cambio de dicho factor es el que genera la trayectoria en espiral
 que se observa al inicio de la prueba, debido al cambio en el radio de curvatura de la trayectoria
 provocado por el aumento de la velocidad.

 Posteriormente, se observa que dichas velocidades $v(t)$ y $\omega(t)$ tienden a estabilizarse en
 valores terminales $v_T$ y $\omega_T$, lo cual se debe a la fricción viscosa en las ruedas. Dado
 que estos valores se mantienen constantes, se pueden obtener las expresiones para $x(t)$ y $y(t)$
 que se muestran en (\ref{eq:x_y_v_omega_cte}), integrando las ecuaciones del modelo en variables de
 estado ya mencionadas. Estas ecuaciones obtenidas corresponden a la parametrización de un círculo,
 el cual está centrado en la posición inicial del robot y presenta un radio
 $R=\frac{v_T}{\omega_T}$. De esta manera, se observa que la trayectoria de la simulación al
 estabilizarse las velocidades es consecuente con (\ref{eq:x_y_v_omega_cte}), al ser dicha curva de forma
 circular cuyo radio coincide con $\frac{v_T}{\omega_T} = 14.34 \hspace{0.1cm} m$.

 \begin{equation}
   \begin{cases}
     \begin{array}{c c c}
       x_T(t) = x0 + \frac{v_T}{\omega_T}\sen(\omega_T t) \\
       y_T(t) = y0 - \frac{v_T}{\omega_T}\cos(\omega_T t)
     \end{array}
   \end{cases}
   \label{eq:x_y_v_omega_cte}
 \end{equation}

 Un resultado importante, consiste en que a pesar de que los torques son iguales y opuestos y que
 entonces la fuerza hacia adelante equivalente $F_m(t)$ aplicada por los motores es cero,
 evidentemente se producen cambios en la velocidad traslacional del centro geométrico del
 robot. Esto es así debido al término $\frac{m_cs}{D}\omega(t)^2$ presente en la ecuación de
 $\dot{v}(t)$ en (\ref{eq:mve_dinamico}), el cual provoca que la velocidad traslacional cambie
 debido a esta relación directa con la velocidad angular del robot. Este término
 se genera debido a que el centro geométrico y el centro de masa del robot simulado no se encuentran
 en el mismo lugar, de manera que hay una inercia asociada a la distancia entre los mismos ($s$), la
 cual provoca que el vehículo acumule energía cinética traslacional. De esta forma, se evidencia que
 bajo estas condiciones de torques de entrada, el robot se mantendría girando sobre sí mismo si la
 distancia entre el centro de masa y el centro geométrico fuera nula.


\begin{figure}[ht]
  \centering
  \includegraphics[width=0.5\linewidth]{../pictures/sim_modelo_dinamico/v_w_vs_tiempo-Prueba_de_torques_opuestos.eps}
  \caption{Velocidad traslacional y angular del robot con respecto al tiempo.\\Simulación de torques constantes y opuestos}
  \label{fig:v_w_vs_t_torques_constantes_opuestos}
\end{figure}


En la gráfica \ref{fig:phi_rl_dot_torques_constantes_opuestos}, se observan las velocidades
angulares en las ruedas del robot en función del tiempo, en donde se evidencia tal como es esperado
que la velocidad de la rueda izquierda es positiva desde el inicio del movimiento, lo cual corresponde
al hecho de que el torque positivo aplicado es el del motor ubicado en esta rueda. 

Por otro lado, al estudiar la curva de la velocidad en la rueda derecha, se puede ver que al inicio
del movimiento la misma es negativa, y que luego de un tiempo esta pasa a tener signo positivo. Esto
es así debido a que al inicio del movimiento el torque aplicado provoca que dicha rueda gire en
sentido contrario al movimiento general del robot, pero luego la energía cinética traslacional
acumulada provoca que esta rueda gire en el mismo sentido que la rueda izquierda.

Se observa además que al transcurrir el tiempo de la simulación, ambas velocidades tienden a
estabilizarse en valores terminales, lo cual ocurre porque $v(t)$ y $\omega(t)$ también llegan a
valores prácticamente constantes, y estas velocidades angulares son combinaciones lineales de $v(t)$
y $\omega(t)$, tal como se evidencia en (\ref{eq:mve_dinamico}). La diferencia entre los valores
terminales de las velocidades angulares en las ruedas, resulta de que es necesario mantener
velocidades distintas para lograr el movimiento circular a rapidez constante que se observa al final
de la simulación.


\begin{figure}[ht]
  \centering
  \includegraphics[width=0.5\linewidth]{../pictures/sim_modelo_dinamico/phi_dot_rl_vs_tiempo-Prueba_de_torques_opuestos.eps}
  \caption{Velocidades angulares en las ruedas con respecto al tiempo.\\Simulación de torques constantes y opuestos}
  \label{fig:phi_rl_dot_torques_constantes_opuestos}
\end{figure}

\subsubsection{Torques Nulos}
Para esta simulación se establecieron condiciones iniciales iguales a cero excepto por $\theta=\frac{(pi)}{4}$ con un tiempo de muestreo de 1500 s. A continuación se presentan las gráficas de dicha simulación.

	\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_torque_igual/entrada.eps}	
	\caption{Entradas del modelo dinamico con respecto al tiempo. Simulación de torques constantes e iguales}
	\label{fig:entrada_torques_iguales}
\end{figure}	

		\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_torque_igual/trayectoria.eps}	
	\caption{Posici?on del centro geom?etrico del robot. Simulación de torques constantes e iguales}
	\label{fig:trayectoria_torques_iguales}
\end{figure}	

	\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_torque_igual/Posicion.eps}	
	\caption{Posición en X y Y con respectoal tiempo. Simulación de torques constantes e iguales}
	\label{fig:posicion_torques_iguales}
\end{figure}	



		\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_torque_igual/velocidad_angular_ruedas.eps}	
	\caption{Velocidades angulares en las ruedas con respecto al tiempo.
Simulaci?on de torques constantes e iguales}
	\label{fig:velocidad_ruedas_torques_iguales}
\end{figure}	

		\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_torque_igual/velocidad_general.eps}	
	\caption{Entrada. Velocidad del carrito}
	\label{fig:velocidad_general_torques_iguales}
\end{figure}	

se observa en la figura \ref{fig:entrada_torques_iguales} el tipo de entrada que se le aplican a las ruedas, en este caso es un torque constante con un valor de 1 $Nm$. A partir de esto se obtiene la gráfica \ref{fig:velocidad_ruedas_torques_iguales} en la cual se puede observar que va aumentando, físicamente tiene sentido debido a la inercia rotacional que tienen las ruedas, esto haría que cada vez vaya aumentando un poco más su velocidad hasta que llegue un determinado punto donde ya no sea posible debido a las pérdidas en la fricción. Si se analiza según las ecuaciones descritas en la ecuación matricial \ref{eq:salidas_mve_dinamico} se puede percatar que es básicamente la misma velocidad traslacional del carrito por un factor, en este caso de 10 veces mayor debido al radio establecido de la rueda. \\
Por otro lado si se analiza la gráfica \ref{fig:velocidad_general_torques_iguales} no existe velocidad rotacional del vehículo y toda la velocidad es traslacional, ya que $\omega$ depende directamente de $T$ mientras que $v$ depende de $F$ por las expresiones descritas en \ref{eq:FyT_friccion}. Expresiones las cuales sí dependen directamente de los torques según lo expresado en \ref{eq:FyT}, en cuyo caso $T$ se hace máximo si los torques van en direcciones contrarias y F se hace máximo si van en direcciones iguales.\\
De lo acabado de mencionar se esperaría que la trayectoria descrita por el robot de dos ruedas fuera completamente una línea recta, ya que al no haber velocidad angular implicaría que no existe un cambio en la posición rotacional del vehículo $\theta$ por definición este se mantendría constante, en este caso como la condición inicial era $\theta = \frac{\pi}{4}$ se mantiene en esta dirección . Esto coincide muy bien con la figura \ref{fig:trayectoria_torques_iguales} en la cual se presenta el recorrido hecho por el robot. 
Finalmente su posición vista en la figura \ref{fig:posicion_torques_iguales} está muy relacionada con el analisis anterior, en este caso la posición de $x$ y $y$ es la misma en todo momento por ser un ángulo de $\frac{\pi}{4}$. Se observa una leve curva al inicio de la gráfica lo cual debe corresponder con el tiempo en el hay aceleración angular ya que estas dependen de los torques netos de cada rueda(los cuales inicialmente son distintos de 0) según el modelo descrito en \ref{eq:salidas_mve_dinamico}, sin embargo, esto deja de ocurrir una vez la fricción iguala el torque de entrada pues el torque de fricción está descrito por la ecuación \ref{eq:torque_friccion}.De este modo existe un punto donde el robot continúa viajando a velocidad constante y por esto termina siendo una recta con una determinada pendiente la cual debería coincidir con la velocidad $v$ final del carrito. 

\subsubsection{Entrada cero, con condiciones iniciales}

A continución se presentan las simulaciones para el modelo dinámico descrito a entrada cero con condiciones iniciales distintas de cero, en este caso se estableció la velocidad inicial $v = 5$  y $\omega=50$ además de su posición inicial $x= 0$  y $y=0$ para facilitar su analisis posicional. 

	\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_entrada0/entrada.eps}	
	\caption{Entrada 0. Entrada}
	\label{fig:entrada_entrada0}
\end{figure}	


	\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_entrada0/Posicion.eps}	
	\caption{Entrada 0.Posicion del carro}
	\label{fig:posicion_entrada0}
\end{figure}	

	\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_entrada0/trayectoria.eps}	
	\caption{Entrada 0. Trayectoria}
	\label{fig:trayectoria_entrada0}
\end{figure}	

		\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_entrada0/velocidad_angular_ruedas.eps}	
	\caption{Entrada 0. Velocidad angular de las ruedas}
	\label{fig:velocidad_ruedas_entrada0}
\end{figure}	

		\begin{figure}[H]
  \centering
	\includegraphics[width=0.8\textwidth]{../pictures/dinamico_entrada0/velocidad_general.eps}	
	\caption{Entrada 0. Velocidad del carrito}
	\label{fig:velocidad_general_entrada0}
\end{figure}	

Se puede observar que para la entra de la figura (\ref{fig:entrada_entrada0}) el robot sigue la trayectoria de \ref{fig:trayectoria_entrada0}, ya que la velocidad $v$ y $\omega$ iniciales son distintas de cero. Esto es lo esperado ya que de acuerdo con la ecuación %%%%%%%%%%%%%%%%%%%%%%%%%%%%

Se logró exitosamente simular el sistema descrito. En las simulaciones se obtienen los resultados observados en el sistema real. Respecto al modelo cinemático, se tiene un modelo que describe correctamente el funcionamiento del sistema real. A pesar que no se toman en consideración las energías del sistema, si el robot se mueve lento, este modelo es suficiente para poder controlarlo. Se debe notar que en el caso de las tres simulaciones, se obtienen los resultados esperados de cada caso. Para poder hacer los resultados de este documento más válidos, se toman los parámetros de un robot real, que se describe en %Citar el articulo**************************

El modelo del punto desplazado logra describir de manera correcta el sistema. Además se logra implementar un sistema simple de control, donde se le envía al robot una trayectoria que debe seguir, y este es capaz de seguirla. Aunque tiene algunos errores (principalemnte en als esuinas), se puede afirmar que el robot es capaz de seguir las trayectorias definidas para las simulaciones. Este conrolde velocidd no es suficiente para aplicaciones más finas, donde se necesite mayor exactitud, en estos casos se debe implementar también un control de posición, somo el propuesto en \citep{Marin}. 

El modelo del punto desplazado, permite describir un modelo inverso, este únicamente controla dos grados de libertad. Sin embargo, como se demostró en las simulaciones, la orientación del robot tiende a ser la adecuada. Conforme el robot avanza, la orientación del robot se modifica, pero esta modificación no afecta al proceso de control de la velocidad traslacional, sino que la orientación se va adaptando a la trayectoria. Para trayectos rectos, se observa un comportamiento asintótico entre el punto central y el punto desplazado, lo que indica que es una buena manera de describir a un robot diferencial cinemáticamente. Note que este modelo es muy útil si el robot se debe mantenr avanzando. Si este no es el caso se debe implementar alguno otro método de control que no se requiera de avance traslacional, para controlar la orientación. 

El modelo cinemático (directo e inverso) no toma en cuenta consideraciones sobre las aceleraciones, entonces puede que se generen velocidades discontínuas, al aplicar una entrada. Para evitar este tipo de salidas se implementa un sistema que permite evitar estas discotinuidades, y suavizar las señales que se obtienen. Con estas limitantes en la salida, se vuelve imposible lograr alguna trayectorias específicas, como por ejemplo completar una trayectoria cuadrada a rapidez constante.

Cuando se toma la trayectoria cuadrada con desaceleración cerca de las esquinas para simularla, se evidencia que el robot es capaz de seuir la trayecoria sin necesidad de hacer girar sus ruedas con aceleraciones infinitas. Este es un factor a tomar en cuenta, si se implementa un sistema real de robot diferencial. El robot puede describir con su punto descentralizado, cualquier trayecotria, siempre y cuando se tenga la velocidad adecuada para lograrlo. 

En general, la salida del modelo dinámico, no toma enconsideración de las restricciones del movimiento, que se toman en cuenta por el modelo dinámico. Sin embargo esto no afecta a los resultados, pues de manera indiracta se cumple. Controlar al punto descentralizado, permite que las velocidades del robot no describan movimientos no permitidos. Sin embargo, cuando se agrega el sistema suavizador para evitar aceleraciones infinitas, se está aumentando el error de la restricción. Ya que este sistema amortigua cualquier discotinuidad, pero no amortigua a todas la sseñales por igual, entonces los cambios más abruptos son más amortiguados, y esos amortiguameintos diferentes, peuden provocar errores en als restricciones del movimeinto. 




\subsubsection{Simulación de torques tren diente de sierra}

En la figura \ref{fig:entrada_torques_tren_sierra}, se muestran los torques de entrada aplicados
para esta simulación, en donde se puede observar que los mismos corresponden a trenes de diente de
sierra que se encuentran alternados entre sí.

\begin{figure}[ht]
  \centering
  \includegraphics[width=0.5\linewidth]{../pictures/sim_modelo_dinamico/torques_m_dinamico-Prueba_de_torques_tren_de_sierra.eps}
  \caption{Entradas del modelo dinámico con respecto al tiempo. \\Simulación de torques tren diente
    de sierra}
  \label{fig:entrada_torques_tren_sierra}
\end{figure}

En las figuras \ref{fig:trayect_robot_torques_tren_sierra} y
\ref{fig:posicion_vs_t_torques_tren_sierra}, se muestra la trayectoria del robot y las coordenadas
de la posición con respecto al tiempo para estas entradas, respectivamente. Se observa como estos
pulsos de sierra alternados en la misma dirección provocan que cada cierta distancia recorrida el
robot cambie su orientación, debido al efecto del torque aplicado en cada rueda individualmente, en
donde nunca se tiene la condición de que los motores de ambas ruedas se encuentren encendidos al
mismo tiempo.
 
\begin{figure}
 	\centering
 	\begin{subfigure}[t]{0.48\textwidth}
            \includegraphics[width=\textwidth]{../pictures/sim_modelo_dinamico/trayect_m_dinamico-Prueba_de_torques_tren_de_sierra.eps}
            \caption{Trayectoria en el plano XY}
            \label{fig:trayect_robot_torques_tren_sierra}
 	\end{subfigure}
 	\begin{subfigure}[t]{0.48\textwidth}
            \includegraphics[width=\textwidth]{../pictures/sim_modelo_dinamico/posicion_vs_tiempo-Prueba_de_torques_tren_de_sierra.eps}
            \caption{Posición en X y Y con respecto \\al tiempo}
            \label{fig:posicion_vs_t_torques_tren_sierra}
 	\end{subfigure}
        \caption{Posición del centro geométrico del robot.\\ Simulación de torques tren diente
    de sierra}
        \label{fig:pos_centro_geometrico_torques_tren_sierra}
 \end{figure}

 En la figura \ref{fig:v_w_vs_t_torques_tren_sierra}, se observa como la velocidad traslacional
 $v(t)$ tiende a conservarse al dejar de aplicar alguno de los pulsos. Esto se explica porque la
 inercia del sistema provoca que se tienda a mantener la velocidad, sin embargo, esta decae
 levemente debido al efecto de la fricción.  También, tal como es esperado
 debido a la inercia del robot, en cada pulso aplicado la velocidad traslacional tiende a aumentar
 cada vez más.

 Por otro lado, al estudiar la velocidad angular $\omega(t)$ de esta gráfica, se observa que los
 principales cambios en la curva ocurren al aplicar cada pulso, tal como es esperado debido al giro
 provocado por el torque de las ruedas. Este giro cambia de sentido entre pulsos debido a que se
 alterna la rueda en donde se aplica el torque, lo cual se evidencia porque entre
 pulsos sucesivos $\omega(t)$ cambia de signo.

\begin{figure}[ht]
  \centering
  \includegraphics[width=0.5\linewidth]{../pictures/sim_modelo_dinamico/v_w_vs_tiempo-Prueba_de_torques_tren_de_sierra.eps}
  \caption{Velocidad traslacional y angular del robot con respecto al tiempo.\\Simulación de torques tren diente
    de sierra}
  \label{fig:v_w_vs_t_torques_tren_sierra}
\end{figure}

En la figura \ref{fig:phi_rl_dot_torques_tren_sierra}, se muestran las velocidades angulares en las
ruedas para esta simulación. Se observa que las mismas cambian de manera esperada al alternarse los pulsos de
los torques en los motores, ya que por ejemplo al aplicar el pulso de torque en la rueda derecha, la
velocidad angular asociada a dicha rueda incrementa para luego decaer levemente debido a la
fricción. Este mismo comportamiento se observa para la rueda izquierda. 

Un resultado importante de esta simulación, consiste en que en medio de los pulsos se observa como
la fricción tiende a equilibrar las velocidades de las dos ruedas, de manera que durante ciertos
instantes ambas velocidades llegan a ser prácticamente iguales.

Esto es así porque la fricción en cierta rueda es directamente proporcional a su respectiva
velocidad, de manera que si una rueda incrementa considerablemente su velocidad, la fricción se va a
oponer en mayor medida al movimiento de dicha rueda y esto provoca que se tiendan a igualar las
velocidades angulares.

\begin{figure}[ht]
  \centering
  \includegraphics[width=0.5\linewidth]{../pictures/sim_modelo_dinamico/phi_dot_rl_vs_tiempo-Prueba_de_torques_tren_de_sierra.eps}
  \caption{Velocidades angulares en las ruedas con respecto al tiempo.\\Simulación de torques tren diente
    de sierra}
  \label{fig:phi_rl_dot_torques_tren_sierra}
\end{figure}


\section{Conclusiones y Recomendaciones}

\subsection{Modelo cinemático}
\begin{itemize}
\item Se logró exitosamente simular el sistema descrito. En las simulaciones se obtienen los resultados observados en el sistema real. Respecto al modelo cinemático, se tiene un modelo que describe correctamente el funcionamiento del sistema real. A pesar que no se toman en consideración las energías del sistema, si el robot se mueve lento, este modelo es suficiente para poder controlarlo. Se debe notar que en el caso de las tres simulaciones, se obtienen los resultados esperados de cada caso. Para poder hacer los resultados de este documento más válidos, se toman los parámetros de un robot real.
 \item El modelo del punto desplazado logra describir de manera correcta el sistema. Además se logra implementar un sistema simple de control, donde se le envía al robot una trayectoria que debe seguir, y este es capaz de seguirla. Aunque tiene algunos errores (principalmente en las esquinas), se puede afirmar que el robot es capaz de seguir las trayectorias definidas para las simulaciones. Este control de velocidad no es suficiente para aplicaciones más finas, donde se necesite mayor exactitud, en estos casos se debe implementar también un control de posición, como el propuesto en \citep{Marin}. 
 \item El modelo del punto desplazado, permite describir un modelo inverso, este únicamente controla dos grados de libertad. Sin embargo, como se demostró en las simulaciones, la orientación del robot tiende a ser la adecuada. Conforme el robot avanza, la orientación del robot se modifica, pero esta modificación no afecta al proceso de control de la velocidad traslacional, sino que la orientación se va adaptando a la trayectoria. Para trayectos rectos, se observa un comportamiento asintótico entre el punto central y el punto desplazado, lo que indica que es una buena manera de describir a un robot diferencial cinemáticamente. Note que este modelo es muy útil si el robot se debe mantener avanzando. Si este no es el caso se debe implementar alguno otro método de control que no se requiera de avance traslacional, para controlar la orientación. 
 \item El modelo cinemático (directo e inverso) no toma en cuenta consideraciones sobre las aceleraciones, entonces puede que se generen velocidades discontinuas, al aplicar una entrada. Para evitar este tipo de salidas se implementa un sistema que permite evitar estas discontinuidades, y suavizar las señales que se obtienen. Con estas limitantes en la salida, se vuelve imposible lograr alguna trayectorias específicas, como por ejemplo completar una trayectoria cuadrada a rapidez constante.
 \item Cuando se toma la trayectoria cuadrada con desaceleración cerca de las esquinas para simularla, se evidencia que el robot es capaz de seguir la trayectoria sin necesidad de hacer girar sus ruedas con aceleraciones infinitas. Este es un factor a tomar en cuenta, si se implementa un sistema real de robot diferencial. El robot puede describir con su punto descentralizado, cualquier trayectoria, siempre y cuando se tenga la velocidad adecuada para lograrlo. 
 \item En general, la salida del modelo dinámico, no toma enconsideración de las restricciones del movimiento, que se toman en cuenta por el modelo dinámico. Sin embargo esto no afecta a los resultados, pues de manera indiracta se cumple. Controlar al punto descentralizado, permite que las velocidades del robot no describan movimientos no permitidos. Sin embargo, cuando se agrega el sistema suavizador para evitar aceleraciones infinitas, se está aumentando el error de la restricción. Ya que este sistema amortigua cualquier discotinuidad, pero no amortigua a todas la sseñales por igual, entonces los cambios más abruptos son más amortiguados, y essos amortiguamientos diferentes, peuden provocar errores en als restricciones del movimeinto.
\end{itemize}

\subsection{Modelo dinámico}
\begin{itemize}
\item La inercia del sistema asociada a la masa del cuerpo y las ruedas del robot, provoca que la
  velocidad traslacional y angular del mismo tiendan a mantenerse. Sin embargo, la fricción modelada
  provoca que estas velocidades tiendan a disminuir de manera natural.
\item A pesar de que el modelo utilizado para la fricción es muy simplificado, el mismo permite
  describir de manera cualitativa el comportamiento esperado para este tipo de fuerza no
  conservativa, ya que en la simulaciones se evidencia como la misma se opone al movimiento
  traslacional y rotacional del robot.
\item La fricción modelada en las ruedas como amortiguadores viscosos torsionales, provoca que las
  velocidades en el sistema no puedan aumentar de manera indefinida, llegándose entonces a valores
  terminales para $v(t)$, $\omega(t)$, $\dot{\varphi_r}(t)$ y  $\dot{\varphi_l}(t)$.
\item La fricción modelada del sistema provoca que la velocidad angular de las ruedas tienda a
  equipararse. Esto debido a que la misma se opone en mayor medida al movimiento de la rueda que
  gire más rápidamente.
\item La distancia $s$ entre el centro geométrico y el centro de masa del robot está asociado a una
  inercia que provoca un movimiento traslacional del mismo incluso al aplicar torques iguales pero
  opuestos en los motores de las ruedas. 
\item Al aplicarse torques opuestos en los motores de las ruedas y al transcurrir tiempo suficiente,
  las velocidades terminales para $v(t)$ y $\omega(t)$ provocan que la trayectoria descrita por el
  robot sea circular, cuyo radio depende de la razón entre estas velocidades.
\item Al tener como entrada torques iguales en los motores y una condición inicial nula para
  $\omega(t)$, el robot describe una trayectoria en línea recta, lo cual se debe a que la velocidad
  angular resultante siempre se mantiene nula. Sin embargo, la velocidad traslacional del robot sí
  puede aumentar bajo estas condiciones.
\item Se puede afirmar a partir de las simulaciones realizadas que el sistema se
  comporta acorde con las ecuaciones obtenidas para el modelo, el cual logra describir de manera
  consecuente la física asociada a la energía cinética traslacional y rotacional de un robot
  diferencial de dos ruedas, sujeto a las condiciones impuestas para el modelado.
\item Como recomendación para trabajos futuros con respecto a este sistema, se propone modelar de
  manera más específica el comportamiento de la fricción, comparando como el modelo de fricción
  utilizado modifica la respuesta del robot, con respecto a un amortiguador viscoso
  torsional.
  
\end{itemize}


\newpage
%-------------------
%bibliografía
\addcontentsline{toc}{section}{Bibliografía}
\bibliographystyle{EIEBib}
\bibliography{informe_ref}
%nombre del archivo .bib que contiene la bibliografía


% ------------------- archivo de apéndice si fuera necesario (* si no hay apéndice comentar las
% siguientes dos líneas *)

%\addcontentsline{toc}{section}{Apéndices}

%------------------
%final del documento
\end{document}
% Lo que se escriba a partir de aquí será ignorado por el compilador